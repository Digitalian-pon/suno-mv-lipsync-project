<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ Gemini Suno Creator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .api-setup {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .api-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 16px;
        }
        
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .mode-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background: #667eea;
            color: white;
        }
        
        .generate-btn {
            display: block;
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 30px;
        }
        
        .generate-btn:hover:not(:disabled) {
            transform: scale(1.02);
        }
        
        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .theme-box {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            margin-bottom: 30px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .result-box {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .result-box.full-width {
            grid-column: span 2;
        }
        
        .result-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-content {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            background: white;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .copy-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .copy-btn:hover {
            background: #45a049;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .controls select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        .message.show {
            opacity: 1;
        }
        
        .message.error {
            background: #dc3545;
        }
        
        .message.warning {
            background: #ffc107;
            color: #333;
        }
        
        @media (max-width: 768px) {
            .results { grid-template-columns: 1fr; }
            h1 { font-size: 2em; }
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ Gemini Suno Creator</h1>
        
        <div class="api-setup">
            <h3>ğŸ”§ Gemini AIè¨­å®š</h3>
            <div class="status" id="apiStatus">
                âŒ Gemini APIæœªæ¥ç¶š
            </div>
            <input type="password" id="apiKey" class="api-input" placeholder="Gemini API Keyã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
            <button onclick="testConnection()" style="margin-top: 10px; padding: 8px 16px; background: #2196f3; color: white; border: none; border-radius: 5px; cursor: pointer;">æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
            <small style="display: block; margin-top: 10px; color: #666;">
                API Keyã¯localStorageã«å®‰å…¨ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚<br>
                å–å¾—æ–¹æ³•: <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a><br>
                <strong>æ³¨æ„:</strong> ãƒ¢ãƒã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯CORSåˆ¶é™ã«ã‚ˆã‚Šæ¥ç¶šã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
                ãã®å ´åˆã¯è‡ªå‹•çš„ã«ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚
            </small>
        </div>
        
        <div class="mode-selector">
            <div class="mode-btn" onclick="selectMode('ai')" id="aiMode">
                ğŸ¤– AIç”Ÿæˆ (Gemini)
            </div>
            <div class="mode-btn active" onclick="selectMode('local')" id="localMode">
                ğŸ  ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆ
            </div>
        </div>
        
        <button class="generate-btn" onclick="generate()" id="generateBtn">
            ğŸ² æ¥½æ›²ç”Ÿæˆ
        </button>
        
        <div class="theme-box" id="themeBox">
            ğŸ¯ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦æ¥½æ›²ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„
        </div>
        
        <div class="results" id="results">
            <!-- çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
    </div>
    
    <div class="message" id="message"></div>

    <script>
        let currentData = null;
        let selectedMode = 'local'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã«å¤‰æ›´
        let apiConnected = false;
        
        // ãƒ†ãƒ¼ãƒãƒ‡ãƒ¼ã‚¿
        const themes = [
            "æ™‚ã‚’ã‹ã‘ã‚‹æ‹ (ã‚¿ã‚¤ãƒ ãƒªãƒ¼ãƒ—, é‹å‘½, åˆ‡ãªã„æ‹)",
            "AIå°‘å¥³ã¨ã®æ‹ (äººå·¥çŸ¥èƒ½, ãƒ‡ã‚¸ã‚¿ãƒ«æ„›, æ„Ÿæƒ…)",
            "ç•°ä¸–ç•Œã§ã®å¤±æ‹ (ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼, é­”æ³•, åˆ¥ã‚Œ)",
            "ãƒ¯ãƒ¼ãƒ—ã—ãŸå…ˆã®å› (æ™‚ç©º, ç¬é–“ç§»å‹•, å†ä¼š)",
            "ãƒ‡ã‚¸ã‚¿ãƒ«ä¸–ç•Œã®ç‰‡æƒ³ã„ (ãƒ¡ã‚¿ãƒãƒ¼ã‚¹, ã‚¢ãƒã‚¿ãƒ¼, ã‚ªãƒ³ãƒ©ã‚¤ãƒ³)",
            "ãƒ«ãƒ¼ãƒ—ã™ã‚‹å‘Šç™½ (ç„¡é™ãƒ«ãƒ¼ãƒ—, ç¹°ã‚Šè¿”ã—, è«¦ã‚)",
            "AIãŒæ­Œã†å¤±æ‹æ­Œ (æ©Ÿæ¢°ã®å¿ƒ, å­¦ç¿’, ãƒ‡ãƒ¼ã‚¿)",
            "ç•°æ¬¡å…ƒæ‹æ„›äº‹æƒ… (ãƒ‘ãƒ©ãƒ¬ãƒ«ãƒ¯ãƒ¼ãƒ«ãƒ‰, åˆ¥ã®è‡ªåˆ†)",
            "ã‚µã‚¤ãƒãƒ¼ç©ºé–“ã®åˆæ‹ (ãƒãƒƒãƒˆ, ã‚³ãƒ¼ãƒ‰, ãƒ—ãƒ­ã‚°ãƒ©ãƒ )",
            "æ™‚é–“åœæ­¢ä¸­ã®æ‹ (é™æ­¢, æ°¸é , ç¬é–“)",
            "ãƒ›ãƒ­ã‚°ãƒ©ãƒ ã®æ‹äºº (å…‰, å¹»å½±, è§¦ã‚Œã‚‰ã‚Œãªã„)",
            "è¨˜æ†¶ã‚’æ¶ˆã•ã‚ŒãŸæ‹ (å¿˜å´, æ€ã„å‡º, æ¶ˆå»)",
            "é‡å­ã‚‚ã¤ã‚Œã®æ„› (é‡å­ç‰©ç†å­¦, åŒæœŸ, è·é›¢ç„¡é–¢ä¿‚)",
            "ãƒãƒ¼ãƒãƒ£ãƒ«çµå©šå¼ (ä»®æƒ³ç¾å®Ÿ, ã‚»ãƒ¬ãƒ¢ãƒ‹ãƒ¼, ãƒ‡ã‚¸ã‚¿ãƒ«èª“ã„)",
            "ãƒã‚ªãƒ³ãƒ©ã‚¤ãƒˆã®ä¸‹ã§ (éƒ½å¸‚å¤œæ™¯, å…‰, å‡ºä¼šã„)",
            "ãƒ¡ã‚¿ãƒãƒ¼ã‚¹ã®ç§˜å¯† (éš ã•ã‚ŒãŸçœŸå®Ÿ, æ¢ç´¢, è¬)",
            "ã‚¿ã‚¤ãƒ ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹æ‹æ„› (æ™‚é–“çŸ›ç›¾, å› æœé–¢ä¿‚, è¤‡é›‘)",
            "AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¸ã®æƒ³ã„ (äººå·¥çŸ¥èƒ½, æ—¥å¸¸, ä¾å­˜)",
            "ç•°ä¸–ç•Œè»¢ç”Ÿå¾Œã®å†ä¼š (è»¢ç”Ÿ, å‰ä¸–, è¨˜æ†¶)",
            "æœªæ¥ã‹ã‚‰ã®æ‰‹ç´™ (ã‚¿ã‚¤ãƒ ãƒ¡ãƒ¼ãƒ«, äºˆè¨€, è­¦å‘Š)"
        ];
        
        // APIæ¥ç¶šãƒ†ã‚¹ãƒˆé–¢æ•°ï¼ˆãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼å¯¾å¿œï¼‰
        async function testConnection() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const status = document.getElementById('apiStatus');
            
            if (!apiKey) {
                status.innerHTML = 'âŒ API Keyã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                status.className = 'status disconnected';
                apiConnected = false;
                return;
            }
            
            status.innerHTML = 'ğŸ”„ æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...';
            status.className = 'status';
            
            try {
                // ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§APIã‚’å‘¼ã³å‡ºã—
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        prompt: 'Hello'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.candidates && data.candidates.length > 0) {
                        status.innerHTML = 'âœ… Gemini APIæ¥ç¶šæˆåŠŸ';
                        status.className = 'status connected';
                        apiConnected = true;
                        localStorage.setItem('gemini_api_key', apiKey);
                        showMessage('âœ… APIæ¥ç¶šæˆåŠŸ', 'success');
                    } else {
                        throw new Error('APIå¿œç­”ãŒä¸æ­£ã§ã™');
                    }
                } else {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'APIæ¥ç¶šã‚¨ãƒ©ãƒ¼');
                }
            } catch (error) {
                console.error('APIæ¥ç¶šã‚¨ãƒ©ãƒ¼:', error);
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ç›´æ¥æ¥ç¶šã‚’è©¦è¡Œ
                try {
                    console.log('ãƒ—ãƒ­ã‚­ã‚·å¤±æ•—ã€ç›´æ¥æ¥ç¶šã‚’è©¦è¡Œ...');
                    const directResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: "Hello" }]
                            }]
                        })
                    });
                    
                    if (directResponse.ok) {
                        status.innerHTML = 'âœ… Gemini APIæ¥ç¶šæˆåŠŸï¼ˆç›´æ¥æ¥ç¶šï¼‰';
                        status.className = 'status connected';
                        apiConnected = true;
                        localStorage.setItem('gemini_api_key', apiKey);
                        showMessage('âœ… APIæ¥ç¶šæˆåŠŸ', 'success');
                        return;
                    }
                } catch (directError) {
                    console.log('ç›´æ¥æ¥ç¶šã‚‚å¤±æ•—');
                }
                
                status.innerHTML = 'âŒ æ¥ç¶šå¤±æ•—: ' + error.message;
                status.className = 'status disconnected';
                apiConnected = false;
                
                if (error.message.includes('429')) {
                    showMessage('âš ï¸ APIã‚¯ã‚©ãƒ¼ã‚¿åˆ¶é™ã§ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’ã”åˆ©ç”¨ãã ã•ã„', 'warning');
                    selectMode('local');
                } else {
                    showMessage('âŒ æ¥ç¶šå¤±æ•—ã€‚APIã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ãã ã•ã„', 'error');
                }
            }
        }
        
        // AIç”Ÿæˆé–¢æ•°ï¼ˆãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼å¯¾å¿œï¼‰
        async function generateWithAI(theme) {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) throw new Error('API Keyæœªè¨­å®š');
            
            const prompt = `ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒã§ã€Suno AIç”¨ã®æ¥½æ›²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
ãƒ†ãƒ¼ãƒ: ${theme}

ä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„:
1. ã‚¿ã‚¤ãƒˆãƒ«: å‰µé€ çš„ã§å°è±¡çš„ãªæ¥½æ›²ã‚¿ã‚¤ãƒˆãƒ«
2. æ—¥æœ¬èªæ­Œè©: [Verse 1], [Chorus], [Verse 2], [Chorus], [Bridge]ã®æ§‹æˆã§
3. è‹±èªæ­Œè©: åŒã˜æ§‹æˆã§
4. Sunoã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: ã‚¸ãƒ£ãƒ³ãƒ«ã€ãƒ ãƒ¼ãƒ‰ã€ãƒ†ãƒ³ãƒã‚’å«ã‚€
5. Midjourneyãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: ã‚¢ãƒ«ãƒãƒ ã‚¢ãƒ¼ãƒˆç”¨ã®è¦–è¦šçš„ãªèª¬æ˜`;
            
            let response;
            let data;
            
            try {
                // ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§è©¦è¡Œ
                response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        prompt: prompt
                    })
                });
                
                if (!response.ok) {
                    throw new Error('ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼');
                }
                
                data = await response.json();
                
            } catch (proxyError) {
                console.log('ãƒ—ãƒ­ã‚­ã‚·å¤±æ•—ã€ç›´æ¥æ¥ç¶šã‚’è©¦è¡Œ...');
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ç›´æ¥æ¥ç¶š
                response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: prompt }]
                        }],
                        generationConfig: {
                            temperature: 0.9,
                            maxOutputTokens: 2048
                        }
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(`API Error: ${response.status} - ${error.error?.message || 'Unknown error'}`);
                }
                
                data = await response.json();
            }
            
            const generatedText = data.candidates[0].content.parts[0].text;
            
            // AIã®å‡ºåŠ›ã‚’ãƒ‘ãƒ¼ã‚¹
            const lines = generatedText.split('\n').filter(line => line.trim());
            let title = '', lyricsJP = '', lyricsEN = '', stylePrompt = '', midjourneyPrompt = '';
            let currentSection = '';
            
            for (const line of lines) {
                if (line.includes('ã‚¿ã‚¤ãƒˆãƒ«:') || line.includes('Title:')) {
                    title = line.split(':')[1].trim();
                } else if (line.includes('æ—¥æœ¬èªæ­Œè©:') || line.includes('Japanese Lyrics:')) {
                    currentSection = 'jp';
                } else if (line.includes('è‹±èªæ­Œè©:') || line.includes('English Lyrics:')) {
                    currentSection = 'en';
                } else if (line.includes('Sunoã‚¹ã‚¿ã‚¤ãƒ«') || line.includes('Style:')) {
                    currentSection = 'style';
                    const stylePart = line.split(':')[1];
                    if (stylePart) stylePrompt = stylePart.trim();
                } else if (line.includes('Midjourney') || line.includes('Visual:')) {
                    currentSection = 'midjourney';
                    const mjPart = line.split(':')[1];
                    if (mjPart) midjourneyPrompt = mjPart.trim();
                } else {
                    switch(currentSection) {
                        case 'jp': lyricsJP += line + '\n'; break;
                        case 'en': lyricsEN += line + '\n'; break;
                        case 'style': stylePrompt += ' ' + line; break;
                        case 'midjourney': midjourneyPrompt += ' ' + line; break;
                    }
                }
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            if (!title) title = `AI Generated: ${theme}`;
            if (!lyricsJP) lyricsJP = generateLocally(theme).lyricsJP;
            if (!lyricsEN) lyricsEN = generateLocally(theme).lyricsEN;
            if (!stylePrompt) stylePrompt = 'Electronic Pop, Emotional, 120-130 BPM';
            if (!midjourneyPrompt) midjourneyPrompt = `${theme}, digital art, cinematic`;
            
            return {
                title: title.trim(),
                lyricsJP: lyricsJP.trim(),
                lyricsEN: lyricsEN.trim(),
                stylePrompt: stylePrompt.trim(),
                midjourneyPrompt: midjourneyPrompt.trim()
            };
        }
        
        // ãƒ¢ãƒ¼ãƒ‰é¸æŠé–¢æ•°
        function selectMode(mode) {
            selectedMode = mode;
            document.getElementById('aiMode').classList.toggle('active', mode === 'ai');
            document.getElementById('localMode').classList.toggle('active', mode === 'local');
            
            const btn = document.getElementById('generateBtn');
            btn.textContent = mode === 'ai' ? 'ğŸ¤– AIæ¥½æ›²ç”Ÿæˆ' : 'ğŸ  ãƒ­ãƒ¼ã‚«ãƒ«æ¥½æ›²ç”Ÿæˆ';
        }
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆé–¢æ•°ï¼ˆæ‹¡å¼µç‰ˆï¼‰
        function generateLocally(theme) {
            // ã‚ˆã‚Šè¤‡é›‘ãªãƒ©ãƒ³ãƒ€ãƒ åŒ–
            const now = Date.now();
            const random = now;
            const random1 = now % 100;
            const random2 = Math.floor(Math.random() * 100);
            const random3 = (now + random2) % 100;
            const random4 = Math.floor(Math.random() * 1000) % 100;
            
            const themeBase = theme.split(' ')[0];
            const themeKeywords = theme.match(/\(([^)]+)\)/)?.[1]?.split(',').map(s => s.trim()) || [];
            
            // æ‹¡å¼µã‚¿ã‚¤ãƒˆãƒ«ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ50ç¨®é¡ï¼‰
            const titlePrefixes = [
                'æ˜Ÿç©ºã®', 'æ™‚ã‚’è¶…ãˆãŸ', 'ãƒ‡ã‚¸ã‚¿ãƒ«', 'é‡å­', 'ä»®æƒ³ç¾å®Ÿã®', 'ç„¡é™ã®', 'é‹å‘½ã®', 'å¿˜ã‚Œã‚‰ã‚Œãªã„', 'æ°¸é ã®', 'å¥‡è·¡ã®',
                'å¹»æƒ³çš„ãª', 'ç…Œã‚ã', 'é€æ˜ãª', 'å„šã„', 'æ·±æ·µã®', 'å…‰ã¨å½±ã®', 'é™å¯‚ã®', 'åµã®ä¸­ã®', 'å¤¢è¦‹ã‚‹', 'è¦šé†’ã™ã‚‹',
                'çµæ™¶åŒ–ã—ãŸ', 'èåˆã™ã‚‹', 'å…±é³´ã™ã‚‹', 'èºæ—‹ã®', 'ä¸‡è¯é¡ã®', 'æœ§æœˆå¤œã®', 'é»æ˜ã®', 'é»„æ˜æ™‚ã®', 'çœŸå¤œä¸­ã®', 'æ–°æœˆã®',
                'æº€æœˆã®', 'æµæ˜Ÿç¾¤ã®', 'ã‚ªãƒ¼ãƒ­ãƒ©ã®', 'æ·±æµ·ã®', 'å¤©ç©ºã®', 'åœ°å¹³ç·šã®', 'æ¬¡å…ƒã‚’è¶…ãˆãŸ', 'ãƒ‘ãƒ©ãƒ¬ãƒ«ãª', 'é¡åƒã®', 'åè»¢ã—ãŸ',
                'åŠ é€Ÿã™ã‚‹', 'é™æ­¢ã—ãŸ', 'é€†æµã™ã‚‹', 'å¾ªç’°ã™ã‚‹', 'èºæ—‹çŠ¶ã®', 'å´©å£Šã™ã‚‹', 'å†ç”Ÿã™ã‚‹', 'å¤‰å®¹ã™ã‚‹', 'æ˜‡è¯ã™ã‚‹', 'çµæ™¶ã®'
            ];
            
            const titleSuffixes = [
                'ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼', 'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼', 'ã‚·ãƒ³ãƒ•ã‚©ãƒ‹ãƒ¼', 'ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼', 'ãƒ©ãƒ—ã‚½ãƒ‡ã‚£ãƒ¼', 'ãƒãƒ©ãƒ¼ãƒ‰', 'ãƒ¯ãƒ«ãƒ„', 'ã‚»ãƒ¬ãƒŠãƒ¼ãƒ‡', 'ãƒã‚¯ã‚¿ãƒ¼ãƒ³', 'ã‚¢ãƒ³ã‚»ãƒ ',
                'ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ©', 'ã‚«ãƒ³ã‚¿ãƒ¼ã‚¿', 'ãƒ¬ã‚¯ã‚¤ã‚¨ãƒ ', 'ãƒ—ãƒ¬ãƒªãƒ¥ãƒ¼ãƒ‰', 'ãƒ•ãƒ¼ã‚¬', 'ã‚½ãƒŠã‚¿', 'ã‚³ãƒ³ãƒã‚§ãƒ«ãƒˆ', 'ã‚«ãƒ—ãƒªãƒ¼ã‚¹', 'ã‚¨ãƒãƒ¥ãƒ¼ãƒ‰', 'ãƒãƒ¼ãƒ',
                'ãƒ©ãƒ©ãƒã‚¤', 'ã‚¨ãƒ¬ã‚¸ãƒ¼', 'ãƒ‘ã‚¹ãƒˆãƒ©ãƒ¼ãƒ¬', 'ãƒˆãƒƒã‚«ãƒ¼ã‚¿', 'ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ã‚¢', 'ã‚¤ãƒ³ãƒ—ãƒ­ãƒ“ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³', 'ãƒ¡ãƒ‡ã‚£ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³', 'ã‚»ãƒ¬ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³', 'ãƒã‚¹ã‚¿ãƒ«ã‚¸ã‚¢', 'ãƒ¦ãƒ¼ãƒˆãƒ”ã‚¢',
                'ãƒ‡ã‚£ã‚¹ãƒˆãƒ”ã‚¢', 'ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹', 'ã‚·ãƒ³ã‚¯ãƒ­ãƒ‹ã‚·ãƒ†ã‚£', 'ã‚¨ãƒ”ãƒ•ã‚¡ãƒ‹ãƒ¼', 'ãƒ¡ã‚¿ãƒ¢ãƒ«ãƒ•ã‚©ãƒ¼ã‚¼', 'ã‚¢ãƒã‚«ãƒªãƒ—ã‚¹', 'ã‚¸ã‚§ãƒã‚·ã‚¹', 'ã‚¨ã‚¯ã‚½ãƒ€ã‚¹', 'ã‚ªãƒ‡ãƒƒã‚»ã‚¤', 'ã‚µãƒ¼ã‚¬',
                'ã‚¯ãƒ­ãƒ‹ã‚¯ãƒ«', 'ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰', 'ãƒŸã‚¹ãƒ†ã‚£ãƒ¼ã‚¯', 'ã‚¨ãƒ‹ã‚°ãƒ', 'ãƒ‘ãƒ³ãƒ‰ãƒ©', 'ãƒãƒ¡ã‚·ã‚¹', 'ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹', 'ãƒ´ã‚¡ãƒ«ã‚­ãƒªãƒ¼', 'ã‚»ãƒ©ãƒ•ã‚£ãƒ ', 'ãƒªãƒªã‚¹'
            ];
            
            const titleStyles = [
                ' ï½AI Remixï½', ' (Future Version)', ' [Digital Edit]', ' -Quantum Mix-', ' ~Virtual Edition~', '', ' 2077', ' (Remastered)', ' -Neo Style-', ' [Cyber Remix]',
                ' (å¤¢å¹»ç·¨)', ' ã€è¦šé†’ã€‘', ' -Chronicle-', ' âˆ Infinity', ' /Phase:01/', ' [OVERDRIVE]', ' {Encrypted}', ' >>Decoded<<', ' Â±ZeroÂ±', ' â—†Crystalâ—†',
                ' â– Coreâ– ', ' â–²Ascendâ–²', ' â–¼Descendâ–¼', ' â˜…Novaâ˜…', ' â˜†Stellarâ˜†', ' â™¦Prismâ™¦', ' â™ Shadowâ™ ', ' â™¥Heartâ™¥', ' â™£Trinityâ™£', ' Â§NexusÂ§',
                ' â€ Requiemâ€ ', ' â€¡Rebirthâ€¡', ' âˆ´Thereforeâˆ´', ' âˆµBecauseâˆµ', ' â‰ˆApproximationâ‰ˆ', ' â‰ Paradoxâ‰ ', ' âˆProportionâˆ', ' âˆ«Integralâˆ«', ' Î£ Sum Î£', ' Î© Omega Î©'
            ];
            
            const titlePrefix = titlePrefixes[(random1 + random2) % titlePrefixes.length];
            const titleSuffix = titleSuffixes[(random2 + random3) % titleSuffixes.length];
            const titleStyle = titleStyles[(random3 + random4) % titleStyles.length];
            
            // æ—¥æœ¬èªæ­Œè©ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå„40ç¨®é¡ï¼‰
            const jpSettings = [
                'è¡—ã®ç‰‡éš…', 'æ˜Ÿç©ºã®ä¸‹', 'ãƒã‚ªãƒ³ã®å…‰', 'ãƒ‡ã‚¸ã‚¿ãƒ«ç©ºé–“', 'æ™‚ã®ç‹­é–“', 'å¤¢ã®ä¸­', 'ä»®æƒ³ä¸–ç•Œ', 'é‡å­ã®æµ·', 'ã‚µã‚¤ãƒãƒ¼éƒ½å¸‚', 'æœªæ¥éƒ½å¸‚',
                'æ·±å¤œã®é§…', 'å±‹ä¸Šã®é¢¨', 'é›¨ä¸ŠãŒã‚Šã®è¡—', 'æœç„¼ã‘ã®ç©º', 'æœˆæ˜ã‹ã‚Šã®é“', 'æ¡œå¹é›ªã®ä¸­', 'é›ªã®çµæ™¶', 'è™¹ã®æ©‹', 'é¡ã®è¿·å®®', 'æ°´æ™¶ã®æ£®',
                'é›»è„³ã®æµ·', 'è¨˜æ†¶ã®å›³æ›¸é¤¨', 'æ„Ÿæƒ…ã®å›è·¯', 'ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ', 'ã‚³ãƒ¼ãƒ‰ã®è¿·è·¯', 'ãƒ”ã‚¯ã‚»ãƒ«ã®é›¨', 'ãƒã‚¤ãƒŠãƒªãƒ¼ã®é¢¨', 'ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®è©©', 'ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å¤¢', 'ã‚·ã‚¹ãƒ†ãƒ ã®é¼“å‹•',
                'æ™‚è¨ˆå¡”ã®é ‚ä¸Š', 'åœ°ä¸‹éƒ½å¸‚ã®å…‰', 'æµ®éŠå³¶ã®åº­åœ’', 'ç•°æ¬¡å…ƒã®æ‰‰', 'å¹³è¡Œä¸–ç•Œã®å¢ƒç•Œ', 'å´©å£Šã—ãŸæ¥½åœ’', 'å†ç”Ÿã™ã‚‹ä¸–ç•Œ', 'å‡çµã—ãŸæ™‚é–“', 'åŠ é€Ÿã™ã‚‹ç¾å®Ÿ', 'åè»¢ã—ãŸé¡åƒ'
            ];
            
            const jpActions = [
                'å›ã¨å‡ºä¼šã£ãŸ', 'æƒ³ã„ãŒæº¢ã‚Œã‚‹', 'æ™‚ãŒæ­¢ã¾ã£ãŸ', 'å¿ƒãŒéœ‡ãˆã‚‹', 'ã‚³ãƒ¼ãƒ‰ãŒç¹‹ãŒã‚‹', 'ãƒ‡ãƒ¼ã‚¿ãŒæµã‚Œã‚‹', 'è¨˜æ†¶ãŒè˜‡ã‚‹', 'æ„Ÿæƒ…ãŒç”Ÿã¾ã‚Œã‚‹', 'æ„›ãŒèŠ½ç”Ÿãˆã‚‹', 'å¥‡è·¡ãŒèµ·ãã‚‹',
                'é‹å‘½ãŒäº¤å·®ã™ã‚‹', 'é¡˜ã„ãŒå±Šã', 'å¤¢ãŒç¾å®Ÿã«ãªã‚‹', 'å…‰ãŒå·®ã—è¾¼ã‚€', 'é—‡ãŒæ™´ã‚Œã‚‹', 'æ‰‰ãŒé–‹ã', 'é“ãŒè¦‹ãˆã‚‹', 'ç­”ãˆãŒåˆ†ã‹ã‚‹', 'çœŸå®Ÿã«æ°—ã¥ã', 'è¦šæ‚Ÿã‚’æ±ºã‚ã‚‹',
                'æ¶™ãŒæµã‚Œã‚‹', 'ç¬‘é¡”ãŒæº¢ã‚Œã‚‹', 'å£°ãŒéŸ¿ã', 'æ‰‹ã‚’ç¹‹ã', 'æŠ±ãã—ã‚åˆã†', 'è¦‹ã¤ã‚åˆã†', 'å¯„ã‚Šæ·»ã„åˆã†', 'æ”¯ãˆåˆã†', 'ä¿¡ã˜åˆã†', 'æ„›ã—åˆã†',
                'åˆ¥ã‚Œã‚’å‘Šã’ã‚‹', 'æ—…ç«‹ã£ã¦ã„ã', 'æŒ¯ã‚Šè¿”ã‚‰ãªã„', 'å‰ã‚’å‘ã', 'æ­©ãå§‹ã‚ã‚‹', 'é£›ã³ç«‹ã¤', 'é§†ã‘æŠœã‘ã‚‹', 'ç«‹ã¡æ­¢ã¾ã‚‹', 'æŒ¯ã‚Šè¿”ã‚‹', 'é¸æŠã™ã‚‹'
            ];
            
            const jpEmotions = [
                'åˆ‡ãªã„æ°—æŒã¡', 'æ¸©ã‹ã„æ„›', 'æºã‚Œã‚‹æƒ³ã„', 'æ°¸é ã®ç´„æŸ', 'æ¶ˆãˆãªã„çµ†', 'è¼ãå¸Œæœ›', 'æ·±ã„æ„›æƒ…', 'ç´”ç²‹ãªå¿ƒ', 'å¼·ã„æ„å¿—', 'å„ªã—ã„å…‰',
                'é™ã‹ãªæ±ºæ„', 'ç†±ã„æƒ…ç†±', 'é€æ˜ãªæ„Ÿæƒ…', 'è¤‡é›‘ãªæ€ã„', 'ç´ ç›´ãªæ°—æŒã¡', 'éš ã›ãªã„æƒ³ã„', 'æŠ‘ãˆãã‚Œãªã„è¡å‹•', 'æ­¢ã¾ã‚‰ãªã„é¼“å‹•', 'éœ‡ãˆã‚‹é­‚', 'ç‡ƒãˆã‚‹å¿ƒ',
                'å‡ã¦ã¤ãå­¤ç‹¬', 'æº¶ã‘ã¦ã„ãæ°·', 'æµã‚Œã‚‹æ™‚é–“', 'æ­¢ã¾ã£ãŸé‡', 'å›ã‚‹æ­¯è»Š', 'å£Šã‚ŒãŸæ™‚è¨ˆ', 'ä¿®å¾©ã•ã‚ŒãŸå¿ƒ', 'ç™’ãˆãªã„å‚·', 'æ¶ˆãˆãªã„ç—›ã¿', 'ç”Ÿã¾ã‚Œå¤‰ã‚ã‚‹é­‚',
                'äº¤å·®ã™ã‚‹é‹å‘½', 'å¹³è¡Œç·šã®æ‹', 'èºæ—‹ã®è»Œè·¡', 'å††ç’°ã®ç†', 'å§‹ã¾ã‚Šã¨çµ‚ã‚ã‚Š', 'Î±ã¨Î©', '0ã¨1ã®é–“', 'æœ‰é™ã¨ç„¡é™', 'ç¾å®Ÿã¨å¹»æƒ³', 'å…‰ã¨å½±'
            ];
            
            const jpChorus = [
                'éŸ¿ãæ¸¡ã‚‹', 'è¼ã„ã¦ã‚‹', 'æº¢ã‚Œå‡ºã™', 'åŒ…ã¿è¾¼ã‚€', 'ç¹‹ãŒã£ã¦ã‚‹', 'å…±é³´ã™ã‚‹', 'éœ‡ãˆã¦ã‚‹', 'ç…Œã‚ã„ã¦ã‚‹', 'æº€ã¡ã¦ã„ã', 'åºƒãŒã£ã¦ã',
                'èˆã„ä¸ŠãŒã‚‹', 'é™ã‚Šæ³¨ã', 'æŸ“ã¿æ¸¡ã‚‹', 'çªãæŠœã‘ã‚‹', 'è²«ã„ã¦ã', 'ç…§ã‚‰ã—å‡ºã™', 'å°ã„ã¦ã', 'å‘¼ã³è¦šã¾ã™', 'è§£ãæ”¾ã¤', 'æ˜‡è¯ã™ã‚‹',
                'çµæ™¶åŒ–ã™ã‚‹', 'å…·ç¾åŒ–ã™ã‚‹', 'å¯è¦–åŒ–ã™ã‚‹', 'å®Ÿä½“åŒ–ã™ã‚‹', 'ç‰©è³ªåŒ–ã™ã‚‹', 'æ¦‚å¿µåŒ–ã™ã‚‹', 'æŠ½è±¡åŒ–ã™ã‚‹', 'å˜ç´”åŒ–ã™ã‚‹', 'è¤‡é›‘åŒ–ã™ã‚‹', 'å¤šæ§˜åŒ–ã™ã‚‹',
                'åæŸã™ã‚‹', 'ç™ºæ•£ã™ã‚‹', 'æŒ¯å‹•ã™ã‚‹', 'å…±æŒ¯ã™ã‚‹', 'å¹²æ¸‰ã™ã‚‹', 'å¢—å¹…ã™ã‚‹', 'æ¸›è¡°ã™ã‚‹', 'å¤‰èª¿ã™ã‚‹', 'å¾©èª¿ã™ã‚‹', 'åŒæœŸã™ã‚‹'
            ];
            
            // è‹±èªæ­Œè©ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
            const enSettings = ['digital realm', 'neon city', 'cyber space', 'virtual world', 'quantum field', 'time stream', 'data flow', 'neural net', 'holo deck', 'matrix code'];
            const enDiscoveries = ['Found you', 'Lost in time', 'Connected souls', 'Hearts aligned', 'Minds in sync', 'Love decoded', 'Dreams collide', 'Fates entwined', 'Codes matched', 'Systems linked'];
            const enVisuals = ['Glowing lights', 'Shining bright', 'Colors burst', 'Pixels dance', 'Data streams', 'Holograms', 'Virtual dreams', 'Digital waves', 'Neon beams', 'Cyber trails'];
            const enFeels = ['heart', 'soul', 'mind', 'love', 'dream', 'hope', 'wish', 'voice', 'touch', 'smile'];
            
            // ã‚¸ãƒ£ãƒ³ãƒ«ã¨ãƒ ãƒ¼ãƒ‰
            const genres = ['Electronic Pop', 'Future Bass', 'Synthwave', 'Cyber Pop', 'Digital Ballad', 'Quantum Beat', 'Virtual Rock', 'AI Symphony', 'Techno Ballad', 'Neon Jazz'];
            const moods = ['Emotional', 'Dreamy', 'Nostalgic', 'Hopeful', 'Melancholic', 'Uplifting', 'Mysterious', 'Romantic', 'Ethereal', 'Energetic'];
            const tempos = ['120 BPM', '128 BPM', '140 BPM', '90 BPM', '100 BPM', '110 BPM', '130 BPM', '85 BPM', '125 BPM', '135 BPM'];
            
            // Midjourneyãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
            const artStyles = ['cyberpunk', 'synthwave', 'vaporwave', 'futuristic', 'digital art', 'neon art', 'holographic', 'glitch art', 'pixel art', 'vector art', 'abstract', 'minimalist', 'surreal', 'cosmic', 'ethereal', 'cinematic', 'photorealistic', 'impressionist', 'expressionist', 'pop art'];
            const colorSchemes = ['neon colors', 'pastel gradients', 'electric blue', 'hot pink', 'purple hues', 'cyan tones', 'golden yellow', 'emerald green', 'crimson red', 'violet shades', 'turquoise', 'magenta', 'amber glow', 'silver gleam', 'copper shine', 'rainbow spectrum', 'monochrome', 'sepia tones', 'technicolor', 'prismatic'];
            const atmospheres = ['romantic', 'mysterious', 'dramatic', 'peaceful', 'intense', 'dreamy', 'epic', 'intimate', 'nostalgic', 'futuristic', 'ethereal', 'powerful', 'serene', 'vibrant', 'melancholic', 'uplifting', 'dark', 'bright', 'cosmic', 'urban'];
            
            // è¤‡é›‘ãªé¸æŠãƒ­ã‚¸ãƒƒã‚¯
            const titlePrefix = titlePrefixes[(random1 + random2) % titlePrefixes.length];
            const titleSuffix = titleSuffixes[(random2 + random3) % titleSuffixes.length];
            const titleStyle = titleStyles[(random3 + random4) % titleStyles.length];
            
            const jpSetting = jpSettings[(random1 + now) % jpSettings.length];
            const jpAction = jpActions[(random2 + now) % jpActions.length];
            const jpEmotion = jpEmotions[(random3 + now) % jpEmotions.length];
            const jpChorusWord = jpChorus[(random4 + now) % jpChorus.length];
            
            // è‹±èªæ­Œè©ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
            const enSettings = ['digital realm', 'neon city', 'cyber space', 'virtual world', 'quantum field'];
            const enDiscoveries = ['Found you', 'Lost in time', 'Connected souls', 'Hearts aligned', 'Minds in sync'];
            const enVisuals = ['Glowing lights', 'Shining bright', 'Colors burst', 'Pixels dance', 'Data streams'];
            const enFeels = ['heart', 'soul', 'mind', 'love', 'dream'];
            
            const enSetting = enSettings[random1 % enSettings.length];
            const enDiscovery = enDiscoveries[random2 % enDiscoveries.length];
            const enVisual = enVisuals[random3 % enVisuals.length];
            const enFeel = enFeels[random4 % enFeels.length];
            
            const genre = genres[random % genres.length];
            const mood = moods[(random + 1) % moods.length];
            const tempo = tempos[(random + 2) % tempos.length];
            
            const artStyle = artStyles[random % artStyles.length];
            const colorScheme = colorSchemes[(random + 1) % colorSchemes.length];
            const atmosphere = atmospheres[(random + 2) % atmospheres.length];
            
            // è¿½åŠ ã®ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ 
            const verse2jp1 = ['ãƒ‡ã‚¸ã‚¿ãƒ«ã®', 'ãƒãƒ¼ãƒãƒ£ãƒ«ã®', 'é‡å­ã®', 'é›»å­ã®', 'ãƒ”ã‚¯ã‚»ãƒ«ã®', 'ãƒã‚¤ãƒŠãƒªãƒ¼ã®', 'ã‚¢ãƒŠãƒ­ã‚°ã®', 'ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã®', 'ã‚µã‚¤ãƒãƒ¼ã®', 'ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ã®'][random4 % 10];
            const verse2jp2 = ['æµ·ã‚’è¶Šãˆã¦', 'ç©ºã‚’é£›ã‚“ã§', 'æ¬¡å…ƒã‚’è¶…ãˆã¦', 'æ™‚ã‚’é§†ã‘ã¦', 'å…‰ã«ãªã£ã¦', 'é¢¨ã«ãªã£ã¦', 'æ³¢ã«ãªã£ã¦', 'ç²’å­ã«ãªã£ã¦', 'ãƒ‡ãƒ¼ã‚¿ã«ãªã£ã¦', 'ã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦'][random1 % 10];
            
            return {
                title: `${titlePrefix}${themeBase}${titleSuffix}${titleStyle}`,
                
                lyricsJP: `[Verse 1]\n${jpSetting}ã§${jpAction}\n${jpEmotion}ãŒèƒ¸ã‚’ç· ã‚ä»˜ã‘ã‚‹\n${themeBase}ãŒå¿ƒã«éŸ¿ã„ã¦\næ–°ã—ã„ä¸–ç•ŒãŒ${['å§‹ã¾ã‚‹', 'é–‹ã‹ã‚Œã‚‹', 'åºƒãŒã‚‹', 'ç”Ÿã¾ã‚Œã‚‹', 'ç›®è¦šã‚ã‚‹'][random1 % 5]}\n\n[Pre-Chorus]\n${verse2jp1}${verse2jp2}\nå›ã®${['å£°', 'å§¿', 'ç¬‘é¡”', 'æ¸©ã‚‚ã‚Š', 'è¨˜æ†¶'][random2 % 5]}ã‚’${['æ¢ã—ã¦ã‚‹', 'è¿½ã„ã‹ã‘ã‚‹', 'æ±‚ã‚ã¦ã‚‹', 'å‘¼ã‚“ã§ã‚‹', 'å¾…ã£ã¦ã‚‹'][random3 % 5]}\n\n[Chorus]\n${themeBase}ãŒ${jpChorusWord}å¤œã«\n${['å›ã¨åƒ•ã®', 'äºŒäººã ã‘ã®', 'ç§ãŸã¡ã®', 'é‹å‘½ã®', 'å¥‡è·¡ã®'][random4 % 5]}ç‰©èªã‚’${['æã“ã†', 'ç´¡ã”ã†', 'å‰µã‚ã†', 'æ­ŒãŠã†', 'åˆ»ã‚‚ã†'][random1 % 5]}\n${mood}ãª${['çµ†', 'æƒ³ã„', 'æ„›', 'å¤¢', 'å¸Œæœ›'][random2 % 5]}ã§${['çµã°ã‚Œã¦', 'ç¹‹ãŒã£ã¦', 'åŒ…ã¾ã‚Œã¦', 'æº€ãŸã•ã‚Œã¦', 'è¼ã„ã¦'][random3 % 5]}\n${['æœªæ¥', 'æ˜æ—¥', 'æ°¸é ', 'ç„¡é™', 'æ–°ä¸–ç•Œ'][random4 % 5]}ã¸ã®æ‰‰ã‚’${['é–‹ã“ã†', 'è¶Šãˆã‚ˆã†', 'é€²ã‚‚ã†', 'é£›ã³ç«‹ã¨ã†', 'é§†ã‘æŠœã‘ã‚ˆã†'][random1 % 5]}\n\n[Verse 2]\n${['æ™‚ã‚’è¶…ãˆãŸ', 'æ¬¡å…ƒã‚’è¶ŠãˆãŸ', 'ç©ºé–“ã‚’è¶…ãˆãŸ', 'è·é›¢ã‚’è¶ŠãˆãŸ', 'é™ç•Œã‚’è¶…ãˆãŸ'][random2 % 5]}æƒ³ã„ãŒ\n${['ã‚³ãƒ¼ãƒ‰', 'ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼', 'ãƒªã‚ºãƒ ', 'ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼', 'ã‚·ãƒ³ãƒ•ã‚©ãƒ‹ãƒ¼'][random3 % 5]}ã¨ãªã£ã¦${['æµã‚Œã¦ã', 'éŸ¿ã„ã¦ã', 'ä¼ã‚ã£ã¦ã', 'åºƒãŒã£ã¦ã', 'ç¶šã„ã¦ã'][random4 % 5]}\n${['ãƒãƒ¼ãƒãƒ£ãƒ«', 'ãƒ‡ã‚¸ã‚¿ãƒ«', 'ãƒªã‚¢ãƒ«', 'ã‚¢ãƒŠãƒ­ã‚°', 'ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰'][random1 % 5]}ã§ã‚‚${['æœ¬ç‰©ã®', 'ç¢ºã‹ãª', 'çœŸå®Ÿã®', 'ç´”ç²‹ãª', 'æ°¸é ã®'][random2 % 5]}\n${['æ„›', 'çµ†', 'å¿ƒ', 'é­‚', 'æ„Ÿæƒ…'][random3 % 5]}ãŒ${['ã“ã“ã«ã‚ã‚‹', 'ç”Ÿãã¦ã„ã‚‹', 'è„ˆæ‰“ã£ã¦ã‚‹', 'è¼ã„ã¦ã‚‹', 'å­˜åœ¨ã™ã‚‹'][random4 % 5]}\n\n[Chorus]\n${themeBase}ãŒ${jpChorusWord}å¤œã«\n${['å›ã¨åƒ•ã®', 'äºŒäººã ã‘ã®', 'ç§ãŸã¡ã®', 'é‹å‘½ã®', 'å¥‡è·¡ã®'][random4 % 5]}ç‰©èªã‚’${['æã“ã†', 'ç´¡ã”ã†', 'å‰µã‚ã†', 'æ­ŒãŠã†', 'åˆ»ã‚‚ã†'][random1 % 5]}\n${mood}ãª${['çµ†', 'æƒ³ã„', 'æ„›', 'å¤¢', 'å¸Œæœ›'][random2 % 5]}ã§${['çµã°ã‚Œã¦', 'ç¹‹ãŒã£ã¦', 'åŒ…ã¾ã‚Œã¦', 'æº€ãŸã•ã‚Œã¦', 'è¼ã„ã¦'][random3 % 5]}\n${['æœªæ¥', 'æ˜æ—¥', 'æ°¸é ', 'ç„¡é™', 'æ–°ä¸–ç•Œ'][random4 % 5]}ã¸ã®æ‰‰ã‚’${['é–‹ã“ã†', 'è¶Šãˆã‚ˆã†', 'é€²ã‚‚ã†', 'é£›ã³ç«‹ã¨ã†', 'é§†ã‘æŠœã‘ã‚ˆã†'][random1 % 5]}\n\n[Bridge]\n${jpEmotion}ãŒ\n${['æ°¸é ã«', 'ç„¡é™ã«', 'æœã¦ã—ãªã', 'ã©ã“ã¾ã§ã‚‚', 'ã„ã¤ã¾ã§ã‚‚'][random2 % 10]}${['éŸ¿ãç¶šã‘ã‚‹', 'è¼ãç¶šã‘ã‚‹', 'ç”Ÿãç¶šã‘ã‚‹', 'æµã‚Œç¶šã‘ã‚‹', 'ç¹‹ãŒã‚Šç¶šã‘ã‚‹'][random3 % 5]}\n${themeBase}ã¯\nForever and beyond\n${['å›ã¨å…±ã«', 'æ„›ã¨å…±ã«', 'å¤¢ã¨å…±ã«', 'å¸Œæœ›ã¨å…±ã«', 'æ°¸é ã«'][random4 % 5]}`,
                
                lyricsEN: `[Verse 1]\n${enDiscovery} in the ${enSetting} tonight\n${enVisual} in the ${colorScheme} light\nYour ${enFeel} calling out to me\nIn this ${atmosphere} symphony\n\n[Chorus]\n${themeBase} ${mood} and free\nDancing through eternity\nWith ${genre} in our hearts\nWe'll never be apart\n\n[Verse 2]\n${enVisual} through the digital space\nYour ${enFeel} I can't replace\nIn this world of ones and zeros\nWe're the ultimate heroes\n\n[Chorus]\n${themeBase} ${mood} and free\nDancing through eternity\nWith ${genre} in our hearts\nWe'll never be apart\n\n[Bridge]\nSometimes the signals fade away\nBut our love is here to stay\n${themeBase} will always be\nOur ${atmosphere} destiny`,
                
                stylePrompt: `${genre}, ${mood}, ${tempo}, ${['Female Vocals', 'Male Vocals', 'Duet'][random1 % 3]}`,
                
                midjourneyPrompt: `${themeBase}, ${artStyle}, ${colorScheme}, ${atmosphere}, album cover, 8k`
            };
        }
        
        // ãƒ¡ã‚¤ãƒ³ç”Ÿæˆé–¢æ•°
        async function generate() {
            const btn = document.getElementById('generateBtn');
            const results = document.getElementById('results');
            const themeBox = document.getElementById('themeBox');
            
            // AI ãƒ¢ãƒ¼ãƒ‰ã§APIæœªæ¥ç¶šã®å ´åˆ
            if (selectedMode === 'ai' && !apiConnected) {
                showMessage('å…ˆã«APIæ¥ç¶šãƒ†ã‚¹ãƒˆã‚’è¡Œã£ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = selectedMode === 'ai' ? 'ğŸ¤– AIç”Ÿæˆä¸­...' : 'ğŸ  ç”Ÿæˆä¸­...';
            
            try {
                const theme = themes[Math.floor(Math.random() * themes.length)];
                themeBox.textContent = 'ğŸ¯ ' + theme;
                
                results.innerHTML = '<div class="loading full-width"><div class="spinner"></div>' + 
                    (selectedMode === 'ai' ? 'Gemini AIãŒæ¥½æ›²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆä¸­...' : 'ãƒ­ãƒ¼ã‚«ãƒ«ã§æ¥½æ›²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆä¸­...') + '</div>';
                
                let generatedContent;
                if (selectedMode === 'ai') {
                    try {
                        generatedContent = await generateWithAI(theme);
                    } catch (error) {
                        console.error('AIç”Ÿæˆã‚¨ãƒ©ãƒ¼ã€ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆã«åˆ‡æ›¿:', error);
                        if (error.message && error.message.includes('429')) {
                            showMessage('âš ï¸ APIã‚¯ã‚©ãƒ¼ã‚¿åˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆã«åˆ‡æ›¿ãˆã¾ã™', 'warning');
                        } else {
                            showMessage('âš ï¸ AIç”Ÿæˆã«å¤±æ•—ã€ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆã«åˆ‡æ›¿', 'warning');
                        }
                        results.innerHTML = '<div class="loading full-width"><div class="spinner"></div>ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆã«åˆ‡ã‚Šæ›¿ãˆä¸­...</div>';
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        generatedContent = generateLocally(theme);
                        selectedMode = 'local';
                        selectMode('local');
                    }
                } else {
                    // ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆã®é…å»¶ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    generatedContent = generateLocally(theme);
                }
                
                currentData = {
                    theme: theme,
                    ...generatedContent
                };
                
                displayResults();
                showMessage(selectedMode === 'ai' ? 'ğŸ¤– AIç”Ÿæˆå®Œäº†' : 'ğŸ  ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆå®Œäº†');
                
            } catch (error) {
                console.error('ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                results.innerHTML = `<div style="color: red; text-align: center; padding: 40px;">ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                showMessage('ç”Ÿæˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = selectedMode === 'ai' ? 'ğŸ¤– AIæ¥½æ›²ç”Ÿæˆ' : 'ğŸ  ãƒ­ãƒ¼ã‚«ãƒ«æ¥½æ›²ç”Ÿæˆ';
            }
        }
        
        // çµæœè¡¨ç¤º
        function displayResults() {
            const results = document.getElementById('results');
            
            results.innerHTML = `
                <div class="result-box">
                    <div class="result-header">
                        ğŸµ æ¥½æ›²ã‚¿ã‚¤ãƒˆãƒ«
                        <button class="copy-btn" onclick="copy('title')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content">${currentData.title}</div>
                </div>
                
                <div class="result-box">
                    <div class="result-header">
                        ğŸŒ æ—¥æœ¬èªæ­Œè©
                        <button class="copy-btn" onclick="copy('lyricsJP')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content">${currentData.lyricsJP}</div>
                </div>
                
                <div class="result-box">
                    <div class="result-header">
                        ğŸ‡ºğŸ‡¸ è‹±èªæ­Œè©
                        <button class="copy-btn" onclick="copy('lyricsEN')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content">${currentData.lyricsEN}</div>
                </div>
                
                <div class="result-box">
                    <div class="result-header">
                        ğŸ¨ Sunoã‚¹ã‚¿ã‚¤ãƒ«
                        <button class="copy-btn" onclick="copy('stylePrompt')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content">${currentData.stylePrompt}</div>
                </div>
                
                <div class="result-box full-width">
                    <div class="result-header">
                        ğŸ–¼ï¸ Midjourneyç”»åƒ
                        <button class="copy-btn" onclick="copy('midjourneyPrompt')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="controls">
                        <label>æ¯”ç‡:</label>
                        <select id="aspectRatio" onchange="updateMjPrompt()">
                            <option value="1:1">1:1</option>
                            <option value="9:16">9:16</option>
                            <option value="16:9">16:9</option>
                        </select>
                        <label>ãƒ¢ãƒ‡ãƒ«:</label>
                        <select id="model" onchange="updateMjPrompt()">
                            <option value="v 7">v 7</option>
                            <option value="niji 6">niji 6</option>
                        </select>
                    </div>
                    <div class="result-content" id="mjPrompt">${currentData.midjourneyPrompt} --ar 1:1 --v 7</div>
                </div>
            `;
        }
        
        // Midjourneyãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ›´æ–°
        function updateMjPrompt() {
            if (!currentData) return;
            
            const aspectRatio = document.getElementById('aspectRatio').value;
            const model = document.getElementById('model').value;
            const prompt = `${currentData.midjourneyPrompt} --ar ${aspectRatio} --${model}`;
            
            document.getElementById('mjPrompt').textContent = prompt;
        }
        
        // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
        function copy(type) {
            console.log('Copy function called with type:', type);
            console.log('Current data:', currentData);
            
            if (!currentData) {
                showMessage('âŒ ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            let text = '';
            switch(type) {
                case 'title': 
                    text = currentData.title; 
                    break;
                case 'lyricsJP': 
                    text = currentData.lyricsJP; 
                    break;
                case 'lyricsEN': 
                    text = currentData.lyricsEN; 
                    break;
                case 'stylePrompt': 
                    text = currentData.stylePrompt; 
                    break;
                case 'midjourneyPrompt': 
                    const aspectRatio = document.getElementById('aspectRatio')?.value || '1:1';
                    const model = document.getElementById('model')?.value || 'v 7';
                    text = `${currentData.midjourneyPrompt} --ar ${aspectRatio} --${model}`;
                    break;
                default:
                    showMessage('âŒ ä¸æ˜ãªã‚¿ã‚¤ãƒ—', 'error');
                    return;
            }
            
            console.log('Copying text:', text);
            
            // ãƒ¢ãƒ€ãƒ³ãªã‚³ãƒ”ãƒ¼æ–¹æ³•
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        console.log('Copy successful');
                        showMessage('âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                    })
                    .catch(err => {
                        console.error('Copy failed:', err);
                        fallbackCopy(text);
                    });
            } else {
                fallbackCopy(text);
            }
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚³ãƒ”ãƒ¼
        function fallbackCopy(text) {
            console.log('Using fallback copy method');
            try {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.top = '-9999px';
                document.body.appendChild(textarea);
                textarea.select();
                const success = document.execCommand('copy');
                document.body.removeChild(textarea);
                
                if (success) {
                    console.log('Fallback copy successful');
                    showMessage('âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                } else {
                    console.error('Fallback copy failed');
                    showMessage('âŒ ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (err) {
                console.error('Fallback copy failed:', err);
                showMessage('âŒ ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showMessage(text, type = 'success') {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = 'message show ' + type;
            setTimeout(() => {
                message.classList.remove('show');
            }, 3000);
        }
        
        // åˆæœŸåŒ–
        window.addEventListener('load', () => {
            // ä¿å­˜ã•ã‚ŒãŸAPI Keyã‚’å¾©å…ƒ
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
            }
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ
            selectMode('local');
        });
    </script>
</body>
</html>