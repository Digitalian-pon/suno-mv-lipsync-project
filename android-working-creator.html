<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸµ Android Working Creator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea, #764ba2);
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-size: 2em;
        }
        
        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            -webkit-tap-highlight-color: transparent;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn:disabled {
            background: #999;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }
        
        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†å¯èƒ½ã‚¨ãƒªã‚¢ */
        .api-key-area {
            width: 100%;
            min-height: 60px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-family: monospace;
            font-size: 14px;
            background: white;
            color: #333;
            overflow-wrap: break-word;
            word-break: break-all;
            outline: none;
        }
        
        .api-key-area:focus {
            border-color: #667eea;
            background: #fafafa;
        }
        
        .api-key-area[contenteditable="true"]:empty:before {
            content: "ã“ã“ã‚’ã‚¿ãƒƒãƒ—ã—ã¦APIã‚­ãƒ¼ã‚’å…¥åŠ›";
            color: #999;
        }
        
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .help-text {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .theme-display {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin: 15px 0;
        }
        
        .result-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .result-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-content {
            white-space: pre-wrap;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .api-method-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .method-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .method-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .method-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            align-items: center;
        }
        
        .controls label {
            font-weight: bold;
            color: #667eea;
        }
        
        .controls select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .controls select:focus {
            border-color: #667eea;
            outline: none;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ Android Working Creator</h1>
        <div style="text-align: center; color: #666; margin-bottom: 20px;">
            Claude & Gemini AI æ¥½æ›²ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆAndroidæœ€é©åŒ–ï¼‰
        </div>
        
        <!-- APIé¸æŠ -->
        <div class="section" style="background: linear-gradient(135deg, #FFE5EC, #E5E5FF);">
            <h3>ğŸ¤– AI APIé¸æŠ</h3>
            <div style="display: flex; gap: 10px; justify-content: center; margin: 15px 0;">
                <button class="method-btn active" id="apiClaude" onclick="selectAPI('claude')" style="flex: 1; max-width: 200px;">
                    ğŸ­ Claude API
                </button>
                <button class="method-btn" id="apiGemini" onclick="selectAPI('gemini')" style="flex: 1; max-width: 200px;">
                    ğŸ’ Gemini API
                </button>
            </div>
        </div>
        
        <!-- APIè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section" id="apiSection">
            <h3 id="apiTitle">ğŸ­ Claude APIè¨­å®š</h3>
            
            <div class="help-text">
                <strong>ğŸ“± APIã‚­ãƒ¼å…¥åŠ›æ–¹æ³•ã‚’é¸æŠï¼š</strong>
            </div>
            
            <div class="api-method-buttons">
                <button class="method-btn active" id="method1" onclick="selectMethod(1)">
                    æ–¹æ³•1<br>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                </button>
                <button class="method-btn" id="method2" onclick="selectMethod(2)">
                    æ–¹æ³•2<br>ç›´æ¥å…¥åŠ›
                </button>
                <button class="method-btn" id="method3" onclick="selectMethod(3)">
                    æ–¹æ³•3<br>æ‰‹å‹•å…¥åŠ›
                </button>
            </div>
            
            <!-- æ–¹æ³•1: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
            <div id="method1Content" style="display: block;">
                <button class="btn btn-warning" onclick="promptForApiKey()">
                    ğŸ“ APIã‚­ãƒ¼ã‚’å…¥åŠ›ï¼ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼‰
                </button>
                <div id="promptResult" style="margin-top: 10px; font-family: monospace; font-size: 12px; color: #666;"></div>
            </div>
            
            <!-- æ–¹æ³•2: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†å¯èƒ½div -->
            <div id="method2Content" style="display: none;">
                <div class="help-text" style="background: #fff3cd; border-color: #ffc107;">
                    ä¸‹ã®æ å†…ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€APIã‚­ãƒ¼ã‚’ç›´æ¥å…¥åŠ›ã¾ãŸã¯è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
                </div>
                <div 
                    id="apiKeyDiv" 
                    class="api-key-area"
                    contenteditable="true"
                    spellcheck="false"
                    autocomplete="off"
                    autocorrect="off"
                    autocapitalize="off"
                    oninput="onApiKeyDivChange()"
                ></div>
                <div id="divCharCount" style="text-align: right; font-size: 12px; color: #666; margin-top: 5px;">0æ–‡å­—</div>
            </div>
            
            <!-- æ–¹æ³•3: ãƒœã‚¿ãƒ³ã”ã¨ã«æ–‡å­—å…¥åŠ› -->
            <div id="method3Content" style="display: none;">
                <div class="help-text" style="background: #f0f8ff; border-color: #2196F3;">
                    å„ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦APIã‚­ãƒ¼ã‚’1æ–‡å­—ãšã¤å…¥åŠ›
                </div>
                <div id="manualInput" style="font-family: monospace; padding: 10px; background: #f8f9fa; border-radius: 5px; margin: 10px 0; min-height: 40px; word-break: break-all;"></div>
                <div style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; margin: 10px 0;">
                    <button onclick="addChar('A')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">A</button>
                    <button onclick="addChar('I')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">I</button>
                    <button onclick="addChar('z')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">z</button>
                    <button onclick="addChar('a')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">a</button>
                    <button onclick="addChar('S')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">S</button>
                    <button onclick="addChar('y')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">y</button>
                    <button onclick="addChar('0')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">0</button>
                    <button onclick="addChar('1')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">1</button>
                    <button onclick="addChar('2')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">2</button>
                    <button onclick="addChar('3')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">3</button>
                    <button onclick="addChar('4')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">4</button>
                    <button onclick="addChar('5')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">5</button>
                    <button onclick="addChar('6')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">6</button>
                    <button onclick="addChar('7')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">7</button>
                    <button onclick="addChar('8')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">8</button>
                    <button onclick="addChar('9')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">9</button>
                    <button onclick="addChar('-')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">-</button>
                    <button onclick="addChar('_')" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">_</button>
                    <button onclick="deleteChar()" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; grid-column: span 2;">âŒ«</button>
                </div>
                <button class="btn btn-danger" onclick="clearManualInput()" style="padding: 10px;">ã‚¯ãƒªã‚¢</button>
            </div>
            
            <!-- å…±é€šãƒœã‚¿ãƒ³ -->
            <button class="btn" onclick="testConnection()" id="testBtn">
                ğŸ”Œ æ¥ç¶šãƒ†ã‚¹ãƒˆ
            </button>
            
            <button class="btn btn-danger" onclick="clearApiKey()">
                ğŸ—‘ï¸ APIã‚­ãƒ¼ã‚¯ãƒªã‚¢
            </button>
            
            <div id="apiStatus"></div>
        </div>
        
        <!-- ãƒ†ãƒ¼ãƒç”Ÿæˆ -->
        <div class="section">
            <h3>ğŸ¯ æ¥½æ›²ãƒ†ãƒ¼ãƒ</h3>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button class="btn btn-secondary" onclick="generateAITheme()" id="aiThemeBtn" style="flex: 2;">
                    ğŸ¤– AIãƒã‚ºãƒ†ãƒ¼ãƒç”Ÿæˆ
                </button>
                <button class="btn" onclick="generateRandomTheme()" id="randomThemeBtn" style="flex: 1; background: linear-gradient(135deg, #28a745, #20c997);">
                    ğŸ² ãƒ©ãƒ³ãƒ€ãƒ 
                </button>
            </div>
            <div class="theme-display" id="themeDisplay">
                ãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„
            </div>
        </div>
        
        <!-- æ¥½æ›²ç”Ÿæˆ -->
        <div class="section">
            <button class="btn" onclick="generateSong()" id="generateBtn" disabled>
                ğŸš€ 3åˆ†æ¥½æ›²ã‚’ç”Ÿæˆï¼ˆè¦APIæ¥ç¶šï¼‰
            </button>
        </div>
        
        <!-- çµæœè¡¨ç¤º -->
        <div id="results"></div>
    </div>
    
    <script>
        let apiKey = '';
        let apiConnected = false;
        let currentTheme = '';
        let isGenerating = false;
        let selectedMethod = 1;
        let manualApiKey = '';
        let currentArtwork = '';
        let currentData = {};
        let selectedAPI = 'claude';  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯Claude
        let generatedThemes = [];  // ç”Ÿæˆæ¸ˆã¿ãƒ†ãƒ¼ãƒã®å±¥æ­´
        
        // ãƒã‚ºã‚Šã‚„ã™ã„ãƒ†ãƒ¼ãƒãƒªã‚¹ãƒˆï¼ˆäºˆå‚™ç”¨ï¼‰
        const fallbackThemes = [
            // æ‹æ„›ç³»
            'æ¨ã—ã«èƒŒä¸­ã‚’æŠ¼ã•ã‚ŒãŸå¤', 'ãƒã‚¤ãƒˆå…ˆã®å¥‡è·¡ã®æ‹', 'ã‚¹ãƒãƒ›è¶Šã—ã®åˆæ‹',
            'AIå½¼å¥³ã¨ã®ç´„æŸ', 'ãƒ¡ã‚¿ãƒãƒ¼ã‚¹åˆãƒ‡ãƒ¼ãƒˆ', 'çµ‚é›»ã§å§‹ã¾ã‚‹é’æ˜¥',
            
            // å‹æƒ…ãƒ»çµ†ç³»  
            'ã‚²ãƒ¼ãƒ ä»²é–“ã¨ã®çµ†', 'æ·±å¤œãƒ©ã‚¸ã‚ªã®ç´„æŸ', 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æˆæ¥­ã®å‹æƒ…',
            'æ–‡åŒ–ç¥­å‰å¤œã®å¥‡è·¡', 'å’æ¥­å¼ã®ç©ºã£ã½ãªæ•™å®¤', 'åŒç´šç”Ÿã¸ã®æ„Ÿè¬ã®æ­Œ',
            
            // å¤¢ãƒ»æˆé•·ç³»
            'å¤¢ã‚’è¿½ã„ã‹ã‘ã‚‹å‹‡æ°—', 'è«¦ã‚ãªã„å¿ƒã®æ­Œ', 'YouTuberã¸ã®æ†§æ†¬',
            '18æ­³ã®æ±ºæ„è¡¨æ˜', 'è¦ªã¸ã®æ„Ÿè¬ã®æ‰‹ç´™', 'å¤±æ•—ã‹ã‚‰å­¦ã‚“ã å¼·ã•',
            
            // æ—¥å¸¸ã®å¥‡è·¡ç³»
            'æ·±å¤œã‚³ãƒ³ãƒ“ãƒ‹ã®å¥‡è·¡', 'é›¨ã®æ—¥ã®å°ã•ãªç™ºè¦‹', 'é€šå­¦è·¯ã®å­£ç¯€',
            'ã‚«ãƒ•ã‚§ã§è¦‹ã¤ã‘ãŸå¸Œæœ›', 'å›³æ›¸é¤¨ã§ã®å‡ºä¼šã„', 'é›»è»Šã®ä¸­ã®é¢¨æ™¯',
            
            // ç¾ä»£çš„ãƒ†ãƒ¼ãƒ
            'TikTokã§æœ‰åã«ãªã£ãŸæ—¥', 'ã‚¤ãƒ³ã‚¹ã‚¿ãƒ©ã‚¤ãƒ–ã®å‘ã“ã†å´', 'ã‚²ãƒ¼ãƒ å®Ÿæ³è€…ã¸ã®é“',
            'Vtuberã¨ã—ã¦ã®ç¬¬ä¸€æ­©', 'ãƒœã‚«ãƒ­Pã«ãªã‚‹å¤¢', 'ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã®æ‹'
        ];
        
        // åˆæœŸåŒ–
        window.onload = function() {
            // ä¿å­˜ã•ã‚ŒãŸAPIã‚­ãƒ¼ã‚’å¾©å…ƒ
            const savedClaude = localStorage.getItem('claudeApiKey');
            const savedGemini = localStorage.getItem('geminiApiKey');
            
            if (savedClaude) {
                selectedAPI = 'claude';
                apiKey = savedClaude;
                displayApiKey();
                setTimeout(() => testConnection(), 1000);
            } else if (savedGemini) {
                selectedAPI = 'gemini';
                selectAPI('gemini');
                apiKey = savedGemini;
                displayApiKey();
                setTimeout(() => testConnection(), 1000);
            }
        };
        
        // APIé¸æŠ
        function selectAPI(api) {
            selectedAPI = api;
            document.getElementById('apiClaude').classList.remove('active');
            document.getElementById('apiGemini').classList.remove('active');
            document.getElementById('api' + api.charAt(0).toUpperCase() + api.slice(1)).classList.add('active');
            
            const apiTitle = document.getElementById('apiTitle');
            const promptResult = document.getElementById('promptResult');
            
            if (api === 'claude') {
                apiTitle.innerHTML = 'ğŸ­ Claude APIè¨­å®š';
                apiKey = localStorage.getItem('claudeApiKey') || '';
            } else {
                apiTitle.innerHTML = 'ğŸ’ Gemini APIè¨­å®š';
                apiKey = localStorage.getItem('geminiApiKey') || '';
            }
            
            // è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
            displayApiKey();
            apiConnected = false;
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('apiStatus').innerHTML = '';
        }
        
        // å…¥åŠ›æ–¹æ³•é¸æŠ
        function selectMethod(method) {
            selectedMethod = method;
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.method-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('method' + method).classList.add('active');
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('method1Content').style.display = method === 1 ? 'block' : 'none';
            document.getElementById('method2Content').style.display = method === 2 ? 'block' : 'none';
            document.getElementById('method3Content').style.display = method === 3 ? 'block' : 'none';
        }
        
        // æ–¹æ³•1: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°
        function promptForApiKey() {
            const apiName = selectedAPI === 'claude' ? 'Claude' : 'Gemini';
            const format = selectedAPI === 'claude' ? 'sk-ant-api...ã§å§‹ã¾ã‚‹100æ–‡å­—ç¨‹åº¦' : 'AIzaSy...ã§å§‹ã¾ã‚‹40æ–‡å­—ç¨‹åº¦';
            
            const input = prompt(`${apiName} APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ${format}ï¼‰:`);
            if (input && input.trim()) {
                apiKey = input.trim();
                localStorage.setItem(selectedAPI + 'ApiKey', apiKey);
                displayApiKey();
                document.getElementById('apiStatus').innerHTML = '<div class="status warning">APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚æ¥ç¶šãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</div>';
            }
        }
        
        // æ–¹æ³•2: divå…¥åŠ›å¤‰æ›´æ™‚
        function onApiKeyDivChange() {
            const div = document.getElementById('apiKeyDiv');
            const text = div.textContent || div.innerText || '';
            const count = document.getElementById('divCharCount');
            
            count.textContent = text.length + 'æ–‡å­—';
            
            const isValid = (selectedAPI === 'claude' && text.startsWith('sk-ant-api') && text.length >= 100) ||
                           (selectedAPI === 'gemini' && text.startsWith('AIzaSy') && text.length >= 39);
            
            if (isValid) {
                apiKey = text.trim();
                localStorage.setItem(selectedAPI + 'ApiKey', apiKey);
                count.innerHTML = text.length + 'æ–‡å­— <span style="color: green;">âœ…</span>';
            } else if (text.length > 0) {
                count.innerHTML = text.length + 'æ–‡å­— <span style="color: orange;">âš ï¸</span>';
            }
        }
        
        // æ–¹æ³•3: æ‰‹å‹•æ–‡å­—å…¥åŠ›
        function addChar(char) {
            manualApiKey += char;
            document.getElementById('manualInput').textContent = manualApiKey;
            
            const isValid = (selectedAPI === 'claude' && manualApiKey.startsWith('sk-ant-api') && manualApiKey.length >= 100) ||
                           (selectedAPI === 'gemini' && manualApiKey.startsWith('AIzaSy') && manualApiKey.length >= 39);
            
            if (isValid) {
                apiKey = manualApiKey;
                localStorage.setItem(selectedAPI + 'ApiKey', apiKey);
                document.getElementById('apiStatus').innerHTML = '<div class="status success">âœ… æœ‰åŠ¹ãªAPIã‚­ãƒ¼å½¢å¼ã§ã™</div>';
            }
        }
        
        function deleteChar() {
            if (manualApiKey.length > 0) {
                manualApiKey = manualApiKey.slice(0, -1);
                document.getElementById('manualInput').textContent = manualApiKey;
            }
        }
        
        function clearManualInput() {
            manualApiKey = '';
            document.getElementById('manualInput').textContent = '';
        }
        
        // APIã‚­ãƒ¼è¡¨ç¤º
        function displayApiKey() {
            if (apiKey) {
                const masked = apiKey.substring(0, 10) + '...' + apiKey.substring(apiKey.length - 5);
                document.getElementById('promptResult').textContent = 'APIã‚­ãƒ¼: ' + masked;
                document.getElementById('apiKeyDiv').textContent = apiKey;
                document.getElementById('manualInput').textContent = apiKey;
                manualApiKey = apiKey;
                onApiKeyDivChange();
            }
        }
        
        // APIã‚­ãƒ¼ã‚¯ãƒªã‚¢
        function clearApiKey() {
            if (confirm('APIã‚­ãƒ¼ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                apiKey = '';
                manualApiKey = '';
                localStorage.removeItem(selectedAPI + 'ApiKey');
                apiConnected = false;
                document.getElementById('generateBtn').disabled = true;
                document.getElementById('apiStatus').innerHTML = '';
                document.getElementById('promptResult').textContent = '';
                document.getElementById('apiKeyDiv').textContent = '';
                document.getElementById('manualInput').textContent = '';
                document.getElementById('divCharCount').textContent = '0æ–‡å­—';
                alert('APIã‚­ãƒ¼ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
            }
        }
        
        // APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function testConnection() {
            const status = document.getElementById('apiStatus');
            const testBtn = document.getElementById('testBtn');
            const generateBtn = document.getElementById('generateBtn');
            
            // ç¾åœ¨ã®å…¥åŠ›æ–¹æ³•ã‹ã‚‰å–å¾—
            if (selectedMethod === 2) {
                const div = document.getElementById('apiKeyDiv');
                const text = (div.textContent || div.innerText || '').trim();
                const isValid = (selectedAPI === 'claude' && text.startsWith('sk-ant-api')) ||
                               (selectedAPI === 'gemini' && text.startsWith('AIzaSy'));
                if (isValid) {
                    apiKey = text;
                }
            } else if (selectedMethod === 3) {
                const isValid = (selectedAPI === 'claude' && manualApiKey.startsWith('sk-ant-api')) ||
                               (selectedAPI === 'gemini' && manualApiKey.startsWith('AIzaSy'));
                if (isValid) {
                    apiKey = manualApiKey;
                }
            }
            
            if (!apiKey) {
                status.innerHTML = '<div class="status error">âŒ APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>';
                return;
            }
            
            const validFormat = (selectedAPI === 'claude' && apiKey.startsWith('sk-ant-api')) ||
                              (selectedAPI === 'gemini' && apiKey.startsWith('AIzaSy'));
            
            if (!validFormat) {
                status.innerHTML = '<div class="status error">âŒ ç„¡åŠ¹ãªAPIã‚­ãƒ¼å½¢å¼ã§ã™</div>';
                return;
            }
            
            testBtn.disabled = true;
            testBtn.textContent = 'ğŸ”„ ãƒ†ã‚¹ãƒˆä¸­...';
            status.innerHTML = '<div class="status warning">â³ æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...</div>';
            
            try {
                let response;
                try {
                    const endpoint = selectedAPI === 'claude' ? '/api/claude' : '/api/gemini';
                    response = await fetch('http://localhost:3000' + endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: apiKey,
                            prompt: 'Hello test',
                            temperature: 0.1
                        })
                    });
                } catch (fetchError) {
                    throw new Error('ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚api-server.jsãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„');
                }
                
                let data;
                try {
                    data = await response.json();
                } catch (jsonError) {
                    throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™');
                }
                
                if (response.ok && (data.content || data.candidates)) {
                    apiConnected = true;
                    generateBtn.disabled = false;
                    status.innerHTML = '<div class="status success">âœ… æ¥ç¶šæˆåŠŸï¼AIç”ŸæˆãŒåˆ©ç”¨å¯èƒ½ã§ã™</div>';
                    localStorage.setItem(selectedAPI + 'ApiKey', apiKey);
                } else {
                    // ã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‡¦ç†ã‚’æ”¹å–„
                    let errorMessage = 'Connection failed';
                    if (data.error) {
                        if (typeof data.error === 'string') {
                            errorMessage = data.error;
                        } else if (data.error.message) {
                            errorMessage = data.error.message;
                        } else if (data.error.error) {
                            errorMessage = data.error.error;
                        } else {
                            errorMessage = JSON.stringify(data.error);
                        }
                    }
                    throw new Error(errorMessage);
                }
            } catch (error) {
                apiConnected = false;
                generateBtn.disabled = true;
                const errorMsg = error.message || 'Unknown error';
                console.error('Connection error:', error);
                
                // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è©³ç´°åˆ¤å®š
                let helpMessage = 'api-server.jsãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„';
                if (errorMsg.includes('API key not valid')) {
                    helpMessage = 'APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚æ­£ã—ã„APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                } else if (errorMsg.includes('quota') || errorMsg.includes('rate limit')) {
                    helpMessage = 'APIã®åˆ©ç”¨åˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚ç„¡æ–™æ ã¯1æ—¥1,500ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™';
                } else if (errorMsg.includes('ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“')) {
                    helpMessage = 'api-server.jsãŒèµ·å‹•ã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™';
                }
                
                status.innerHTML = `<div class="status error">âŒ æ¥ç¶šå¤±æ•—: ${errorMsg}<br>${helpMessage}</div>`;
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'ğŸ”Œ æ¥ç¶šãƒ†ã‚¹ãƒˆ';
            }
        }
        
        // AIãƒ†ãƒ¼ãƒç”Ÿæˆï¼ˆãƒã‚ºã‚Šã‚„ã™ã„ãƒ†ãƒ¼ãƒï¼‰
        async function generateAITheme() {
            const btn = document.getElementById('aiThemeBtn');
            const display = document.getElementById('themeDisplay');
            
            if (!apiConnected) {
                alert('å…ˆã«APIæ¥ç¶šãƒ†ã‚¹ãƒˆã‚’æˆåŠŸã•ã›ã¦ãã ã•ã„');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'ğŸ¤– ç”Ÿæˆä¸­...';
            display.textContent = 'AIãŒãƒã‚ºã‚‹ãƒ†ãƒ¼ãƒã‚’è€ƒæ¡ˆä¸­...';
            
            try {
                // ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ã‚’è¿½åŠ ã—ã¦å¤šæ§˜æ€§ã‚’ç¢ºä¿
                const timeStamp = new Date().getTime();
                const randomSeed = Math.floor(Math.random() * 1000);
                
                // ãƒ†ãƒ¼ãƒã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
                const categories = [
                    'æ‹æ„›ãƒ»é’æ˜¥', 'å‹æƒ…ãƒ»çµ†', 'å¤¢ãƒ»æŒ‘æˆ¦', 'æ—¥å¸¸ã®å¥‡è·¡', 
                    'SNSãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«', 'æˆé•·ãƒ»è‡ªå·±è‚¯å®š', 'å®¶æ—ãƒ»æ„Ÿè¬', 'åˆ¥ã‚Œãƒ»å‡ºä¼šã„'
                ];
                const selectedCategory = categories[Math.floor(Math.random() * categories.length)];
                
                // ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
                const trendWords = [
                    'æ¨ã—', 'ã‚¨ãƒ¢ã„', 'ã‚¬ãƒæ‹', 'ãƒ¯ãƒ³ãƒãƒ£ãƒ³', 'ãƒªã‚¢ã‚³',
                    'ãƒã‚ºã‚‹', 'ã‚¤ãƒ³ã‚¹ã‚¿æ˜ ãˆ', 'TikTok', 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³',
                    'èª²é‡‘', 'ã‚½ãƒ­æ´»', 'ãƒ²ã‚¿æ´»', 'ãƒãƒ«', 'ãƒ•ã‚©ãƒˆã‚¸ã‚§ãƒ‹ãƒƒã‚¯'
                ];
                const trendWord = trendWords[Math.floor(Math.random() * trendWords.length)];
                
                const prompt = `ã€ã‚·ãƒ¼ãƒ‰å€¤: ${randomSeed}ã€‘
2024å¹´ã«SNSã§ãƒã‚ºã‚Šãã†ãªæ¥½æ›²ãƒ†ãƒ¼ãƒã‚’1ã¤ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ã€ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€‘${selectedCategory}
ã€ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ¯ãƒ¼ãƒ‰ã€‘${trendWord}ã‚’å‚è€ƒã«ã—ã¦ã‚‚è‰¯ã„

ã€å¿…é ˆæ¡ä»¶ã€‘
- å‰å‘ãã§å…±æ„Ÿã‚’å‘¼ã¶å†…å®¹
- æ„Ÿå‹•ã‚„å‹‡æ°—ã‚’ä¸ãˆã‚‹
- Zä¸–ä»£ï¼ˆ10ä»£-20ä»£ï¼‰ãŒå…±æ„Ÿã§ãã‚‹
- 15æ–‡å­—ä»¥å†…ã®çŸ­ã„ãƒ•ãƒ¬ãƒ¼ã‚º
- ä»Šã¾ã§ç”Ÿæˆã—ãŸã‚‚ã®ã¨é•ã†æ–°ã—ã„ãƒ†ãƒ¼ãƒ

ã€NGä¾‹ï¼ˆã“ã‚Œã‚‰ã¨ä¼¼ãŸã‚‚ã®ã¯é¿ã‘ã‚‹ï¼‰ã€‘
- æ¨ã—ã«èƒŒä¸­ã‚’æŠ¼ã•ã‚ŒãŸå¤
- ãƒã‚¤ãƒˆå…ˆã®å¥‡è·¡ã®æ‹
- æ·±å¤œãƒ©ã‚¸ã‚ªã®ç´„æŸ
${generatedThemes.length > 0 ? '- ' + generatedThemes.join('\n- ') : ''}

ç‹¬å‰µçš„ã§æ–°ã—ã„ãƒ†ãƒ¼ãƒã‚’1ã¤ã ã‘å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ã¯ä¸è¦ã§ã™ã€‚`;

                let theme = await callAI(prompt);
                // æ”¹è¡Œã‚„ä½™åˆ†ãªæ–‡å­—ã‚’å‰Šé™¤
                theme = theme.trim().replace(/[\n\r]/g, '').replace(/^[ã€Œã€"']|[ã€ã€"']$/g, '');
                
                // 15æ–‡å­—ã‚’è¶…ãˆãŸã‚‰çŸ­ç¸®
                if (theme.length > 15) {
                    theme = theme.substring(0, 15);
                }
                
                currentTheme = theme;
                display.textContent = 'ğŸ”¥ ' + currentTheme;
                
                // ç”Ÿæˆå±¥æ­´ã«è¿½åŠ ï¼ˆæœ€å¤§10å€‹ä¿æŒï¼‰
                generatedThemes.push(theme);
                if (generatedThemes.length > 10) {
                    generatedThemes.shift();
                }
                
            } catch (error) {
                console.error('AI theme generation failed:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šãƒ©ãƒ³ãƒ€ãƒ ãƒ†ãƒ¼ãƒ
                generateRandomTheme();
                alert('AIãƒ†ãƒ¼ãƒç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ©ãƒ³ãƒ€ãƒ ãƒ†ãƒ¼ãƒã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ¤– AIãƒã‚ºãƒ†ãƒ¼ãƒç”Ÿæˆ';
            }
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãƒ†ãƒ¼ãƒç”Ÿæˆï¼ˆäºˆå‚™ï¼‰
        function generateRandomTheme() {
            currentTheme = fallbackThemes[Math.floor(Math.random() * fallbackThemes.length)];
            document.getElementById('themeDisplay').textContent = 'ğŸ² ' + currentTheme;
        }
        
        // æ¥½æ›²ç”Ÿæˆ
        async function generateSong() {
            if (!currentTheme) {
                alert('å…ˆã«ãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!apiConnected) {
                alert('å…ˆã«APIæ¥ç¶šãƒ†ã‚¹ãƒˆã‚’æˆåŠŸã•ã›ã¦ãã ã•ã„');
                return;
            }
            
            if (isGenerating) return;
            
            const btn = document.getElementById('generateBtn');
            const results = document.getElementById('results');
            
            isGenerating = true;
            btn.disabled = true;
            btn.textContent = 'ğŸ”„ ç”Ÿæˆä¸­...';
            
            results.innerHTML = '<div class="status warning">ğŸµ æ¥½æ›²ã‚’ç”Ÿæˆä¸­...</div>';
            
            try {
                // ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆ
                const title = await callAI(`"${currentTheme}"ã®æ¥½æ›²ã‚¿ã‚¤ãƒˆãƒ«ã‚’1ã¤ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚å°è±¡çš„ã§è¦šãˆã‚„ã™ã„ã‚¿ã‚¤ãƒˆãƒ«ã€‚ã‚¿ã‚¤ãƒˆãƒ«ã®ã¿å‡ºåŠ›ã€‚`);
                
                // æ—¥æœ¬èªæ­Œè©ç”Ÿæˆï¼ˆ3åˆ†æ¥½æ›²ç”¨ï¼‰
                const lyricsJP = await callAI(`${currentTheme}ã®æ—¥æœ¬èªæ­Œè©ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚3åˆ†ç¨‹åº¦ã®æ¥½æ›²ã‚’æƒ³å®šã—ã¦ã€ä»¥ä¸‹ã®æ§‹æˆã§ä½œæˆã—ã¦ãã ã•ã„ï¼š
[Intro] (2è¡Œ)
[Verse 1] (4è¡Œ)
[Pre-Chorus] (2è¡Œ)
[Chorus] (4è¡Œ)
[Verse 2] (4è¡Œ)
[Pre-Chorus] (2è¡Œ)
[Chorus] (4è¡Œ)
[Bridge] (4è¡Œ)
[Chorus] (4è¡Œ)
[Outro] (2è¡Œ)

åˆè¨ˆ32è¡Œç¨‹åº¦ã€‚å„ãƒ‘ãƒ¼ãƒˆã¯ç°¡æ½”ã«ã€æ„Ÿæƒ…ã‚’è¾¼ã‚ã¦ã€‚æ­Œè©ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`);
                
                // è‹±èªæ­Œè©ç”Ÿæˆï¼ˆ3åˆ†æ¥½æ›²ç”¨ï¼‰
                const lyricsEN = await callAI(`${currentTheme}ã®è‹±èªæ­Œè©ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚3åˆ†ç¨‹åº¦ã®æ¥½æ›²ã‚’æƒ³å®šã—ã¦ã€ä»¥ä¸‹ã®æ§‹æˆã§ä½œæˆã—ã¦ãã ã•ã„ï¼š
[Intro] (2è¡Œ)
[Verse 1] (4è¡Œ)
[Pre-Chorus] (2è¡Œ)
[Chorus] (4è¡Œ)
[Verse 2] (4è¡Œ)
[Pre-Chorus] (2è¡Œ)
[Chorus] (4è¡Œ)
[Bridge] (4è¡Œ)
[Chorus] (4è¡Œ)
[Outro] (2è¡Œ)

åˆè¨ˆ32è¡Œç¨‹åº¦ã€‚ç°¡æ½”ã§ã‚­ãƒ£ãƒƒãƒãƒ¼ãªè‹±èªæ­Œè©ã€‚æ­Œè©ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`);
                
                // ã‚¹ã‚¿ã‚¤ãƒ«ç”Ÿæˆ
                const style = await callAI(`"${currentTheme}"ã®éŸ³æ¥½ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚ã‚¸ãƒ£ãƒ³ãƒ«ã€ãƒ ãƒ¼ãƒ‰ã€BPMã‚’å«ã‚ã¦20èªä»¥å†…ã§ã€‚`);
                
                // Midjourneyãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼ˆ30å­—ä»¥å†…ï¼‰
                const artwork = await callAI(`"${currentTheme}"ã®Midjourneyãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è‹±èª30å­—ä»¥å†…ã§ç”Ÿæˆã€‚ç°¡æ¼ã«ã€‚`);
                
                // ã‚¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä¿å­˜
                currentArtwork = artwork;
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                currentData = {
                    title: title,
                    lyricsJP: lyricsJP,
                    lyricsEN: lyricsEN,
                    style: style,
                    artwork: artwork
                };
                
                // çµæœè¡¨ç¤º
                displayResults(currentData);
                
            } catch (error) {
                results.innerHTML = `<div class="status error">âŒ ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            } finally {
                isGenerating = false;
                btn.disabled = false;
                btn.textContent = 'ğŸš€ 3åˆ†æ¥½æ›²ã‚’ç”Ÿæˆï¼ˆè¦APIæ¥ç¶šï¼‰';
            }
        }
        
        // AI APIå‘¼ã³å‡ºã—ï¼ˆClaude/Geminiä¸¡å¯¾å¿œï¼‰
        async function callAI(prompt) {
            const endpoint = selectedAPI === 'claude' ? '/api/claude' : '/api/gemini';
            
            const response = await fetch('http://localhost:3000' + endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    apiKey: apiKey,
                    prompt: prompt,
                    temperature: 0.9
                })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || 'API Error');
            }
            
            // Claude APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
            if (selectedAPI === 'claude' && data.content && data.content[0]) {
                return data.content[0].text;
            }
            // Gemini APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
            else if (selectedAPI === 'gemini' && data.candidates && data.candidates[0]) {
                return data.candidates[0].content.parts[0].text;
            }
            else {
                throw new Error('No response from API');
            }
        }
        
        // çµæœè¡¨ç¤º
        function displayResults(content) {
            const results = document.getElementById('results');
            
            results.innerHTML = `
                <div class="result-box">
                    <div class="result-header">
                        ğŸµ æ¥½æ›²ã‚¿ã‚¤ãƒˆãƒ«
                        <button class="copy-btn" onclick="copyTitle()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content" id="titleContent">${content.title}</div>
                </div>
                
                <div class="result-box">
                    <div class="result-header">
                        ğŸŒ æ—¥æœ¬èªæ­Œè©ï¼ˆ3åˆ†æ¥½æ›²ç”¨ï¼‰
                        <button class="copy-btn" onclick="copyLyricsJP()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content" id="lyricsJPContent">${content.lyricsJP}</div>
                </div>
                
                <div class="result-box">
                    <div class="result-header">
                        ğŸ‡ºğŸ‡¸ è‹±èªæ­Œè©ï¼ˆ3åˆ†æ¥½æ›²ç”¨ï¼‰
                        <button class="copy-btn" onclick="copyLyricsEN()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content" id="lyricsENContent">${content.lyricsEN}</div>
                </div>
                
                <div class="result-box">
                    <div class="result-header">
                        ğŸ¨ éŸ³æ¥½ã‚¹ã‚¿ã‚¤ãƒ«
                        <button class="copy-btn" onclick="copyStyle()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content" id="styleContent">${content.style}</div>
                </div>
                
                <div class="result-box">
                    <div class="result-header">
                        ğŸ–¼ï¸ Midjourneyã‚¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯
                        <button class="copy-btn" onclick="copyArtwork()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="controls">
                        <label>æ¯”ç‡:</label>
                        <select id="aspectRatio" onchange="updateMjPrompt()">
                            <option value="1:1">1:1</option>
                            <option value="9:16">9:16</option>
                            <option value="16:9">16:9</option>
                        </select>
                        <label>ãƒ¢ãƒ‡ãƒ«:</label>
                        <select id="model" onchange="updateMjPrompt()">
                            <option value="v 7">v 7</option>
                            <option value="niji 6">niji 6</option>
                        </select>
                    </div>
                    <div class="result-content" id="artworkContent">${content.artwork} --ar 1:1 --v 7</div>
                </div>
            `;
        }
        
        // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
        function copyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('ğŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            } catch (err) {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚');
            }
            
            document.body.removeChild(textArea);
        }
        
        // æ—¥æœ¬èªæ­Œè©ã‚³ãƒ”ãƒ¼å°‚ç”¨
        function copyLyricsJP() {
            const lyrics = document.getElementById('lyricsJPContent').textContent;
            copyText(lyrics);
        }
        
        // è‹±èªæ­Œè©ã‚³ãƒ”ãƒ¼å°‚ç”¨
        function copyLyricsEN() {
            const lyrics = document.getElementById('lyricsENContent').textContent;
            copyText(lyrics);
        }
        
        // Midjourneyãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ›´æ–°
        function updateMjPrompt() {
            if (!currentArtwork) return;
            
            const aspectRatio = document.getElementById('aspectRatio').value;
            const model = document.getElementById('model').value;
            const prompt = `${currentArtwork} --ar ${aspectRatio} --${model}`;
            
            document.getElementById('artworkContent').textContent = prompt;
        }
        
        // ã‚¿ã‚¤ãƒˆãƒ«ã‚³ãƒ”ãƒ¼å°‚ç”¨
        function copyTitle() {
            const title = document.getElementById('titleContent').textContent;
            copyText(title);
        }
        
        // ã‚¹ã‚¿ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼å°‚ç”¨
        function copyStyle() {
            const style = document.getElementById('styleContent').textContent;
            copyText(style);
        }
        
        // ã‚¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ã‚³ãƒ”ãƒ¼å°‚ç”¨
        function copyArtwork() {
            const artwork = document.getElementById('artworkContent').textContent;
            copyText(artwork);
        }
    </script>
</body>
</html>