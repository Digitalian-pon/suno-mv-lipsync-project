<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ Claude Suno Creator - AIãƒã‚ºæ¥½æ›²ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #FF006E 0%, #8338EC 50%, #3A86FF 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 35px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            background: linear-gradient(135deg, #FF006E, #8338EC);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-size: 2.8em;
            font-weight: bold;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .api-setup {
            background: linear-gradient(135deg, #FFE5EC, #E5E5FF);
            border: 2px solid #FF006E;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .api-setup h3 {
            color: #FF006E;
            margin-bottom: 15px;
        }
        
        .api-input {
            width: 100%;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 14px;
            font-family: monospace;
            transition: border-color 0.3s;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .api-input:focus {
            outline: none;
            border-color: #FF006E;
        }
        
        .api-display {
            width: 100%;
            padding: 14px;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 12px;
            font-family: monospace;
            background: #f0f0f0;
            word-break: break-all;
            max-height: 150px;
            overflow-y: auto;
            display: none;
        }
        
        .test-btn {
            margin-top: 15px;
            padding: 12px 30px;
            background: linear-gradient(135deg, #FF006E, #8338EC);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
        }
        
        .mode-selector {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .mode-btn {
            padding: 12px 25px;
            border: 2px solid #ddd;
            border-radius: 30px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }
        
        .mode-btn.active {
            border-color: #FF006E;
            background: linear-gradient(135deg, #FF006E, #8338EC);
            color: white;
            transform: scale(1.05);
        }
        
        .theme-section {
            background: linear-gradient(135deg, #FFF0F5, #F0F0FF);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .theme-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .theme-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #3A86FF, #8338EC);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 17px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .theme-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(131, 56, 236, 0.3);
        }
        
        .theme-btn:disabled {
            background: #999;
            cursor: not-allowed;
        }
        
        .theme-box {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            color: #FF006E;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .generate-btn {
            display: block;
            width: 90%;
            max-width: 350px;
            margin: 30px auto;
            padding: 20px;
            background: linear-gradient(135deg, #FF006E 0%, #8338EC 50%, #3A86FF 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(131, 56, 236, 0.3);
        }
        
        .generate-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(131, 56, 236, 0.4);
        }
        
        .generate-btn:disabled {
            background: #999;
            cursor: not-allowed;
        }
        
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .result-box {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .result-box:hover {
            transform: translateY(-5px);
        }
        
        .result-box.full-width {
            grid-column: 1 / -1;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.1em;
            color: #FF006E;
        }
        
        .result-content {
            white-space: pre-wrap;
            background: #f8f8f8;
            padding: 15px;
            border-radius: 10px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .copy-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #3A86FF, #8338EC);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .copy-btn:hover {
            transform: scale(1.1);
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .controls label {
            font-weight: bold;
            color: #666;
        }
        
        .controls select {
            padding: 8px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .controls select:focus {
            outline: none;
            border-color: #FF006E;
        }
        
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.5s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .message.success {
            background: linear-gradient(135deg, #00C896, #00A884);
        }
        
        .message.error {
            background: linear-gradient(135deg, #FF3838, #FF006E);
        }
        
        .message.warning {
            background: linear-gradient(135deg, #FFA500, #FF6B35);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            font-size: 1.2em;
            color: #666;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            margin: 0 auto 20px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #FF006E;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .viral-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .api-info {
            background: #e8f4f8;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .api-info a {
            color: #2196f3;
            text-decoration: none;
            font-weight: bold;
        }
        
        .api-info a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ Claude Suno Creator</h1>
        <div class="subtitle">Claude AIæ­è¼‰ï¼æ¬¡ä¸–ä»£æ¥½æ›²ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
        
        <!-- ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚¨ãƒªã‚¢ -->
        <div id="debugLog" style="background: #f0f0f0; padding: 10px; margin: 20px 0; border-radius: 5px; max-height: 200px; overflow-y: auto; display: none;">
            <h4>ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°:</h4>
            <pre id="debugContent" style="margin: 0; font-size: 12px;"></pre>
        </div>
        
        <!-- AI APIé¸æŠ -->
        <div class="api-selection" style="margin-bottom: 30px; text-align: center;">
            <h3>ğŸ¤– AI APIé¸æŠ</h3>
            <div style="display: flex; gap: 15px; justify-content: center; margin: 20px 0;">
                <button class="mode-btn active" id="apiClaude" onclick="selectAPI('claude')">ğŸ­ Claude AI</button>
                <button class="mode-btn" id="apiGemini" onclick="selectAPI('gemini')">ğŸ’ Gemini AI</button>
            </div>
        </div>

        <!-- Claude APIè¨­å®š -->
        <div class="api-setup" id="claudeSetup">
            <h3>ğŸ”‘ Claude APIè¨­å®š</h3>
            <div class="api-info">
                ğŸ“Œ <strong>Claude APIã‚­ãƒ¼ã®å–å¾—æ–¹æ³•:</strong><br>
                1. <a href="https://console.anthropic.com/settings/keys" target="_blank">Anthropic Console</a> ã«ã‚¢ã‚¯ã‚»ã‚¹<br>
                2. "Create Key" ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
                3. <strong style="color: red;">ã‚­ãƒ¼å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆ100æ–‡å­—ä»¥ä¸Šï¼‰</strong><br>
                   ä¾‹: sk-ant-api03-xxxxxxxxxx...ï¼ˆé•·ã„æ–‡å­—åˆ—ï¼‰<br>
                4. ä¸‹è¨˜ã«è²¼ã‚Šä»˜ã‘ã¦æ¥ç¶šãƒ†ã‚¹ãƒˆ<br>
                <div style="background: #fff3cd; padding: 10px; margin-top: 10px; border-radius: 5px; border: 1px solid #ffc107;">
                    âš ï¸ <strong>æ³¨æ„:</strong> APIã‚­ãƒ¼ã¯100æ–‡å­—ä»¥ä¸Šã®é•·ã„æ–‡å­—åˆ—ã§ã™ã€‚<br>
                    ã€Œsk-ant-api03-ã€ã®éƒ¨åˆ†ã ã‘ã§ãªãã€ãã®å¾Œã®å…¨ã¦ã®æ–‡å­—ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>
            <textarea id="claudeApiKey" class="api-input" placeholder="Claude API Key (sk-ant-api...)ã‚’å…¥åŠ›" style="width: 100%; min-height: 60px; resize: vertical; font-family: monospace; font-size: 12px;" onpaste="handleApiKeyPaste(event, 'claude')"></textarea>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button onclick="toggleApiKeyVisibility('claude')" style="padding: 12px 20px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer;" id="claudeVisibilityBtn">ğŸ‘ï¸ è¡¨ç¤º/éè¡¨ç¤º</button>
                <button onclick="clearApiKey('claude')" style="padding: 12px 20px; background: #ff6b6b; color: white; border: none; border-radius: 8px; cursor: pointer;">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                <span id="claudeCharCount" style="padding: 12px; color: #666; font-weight: bold;"></span>
            </div>
            <div id="claudeApiKeyDisplay" class="api-display"></div>
            <button class="test-btn" onclick="testConnection('claude')">ğŸ”Œ Claudeæ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
            <div id="claudeApiStatus" style="margin-top: 15px; text-align: center;"></div>
        </div>

        <!-- Gemini APIè¨­å®š -->
        <div class="api-setup" id="geminiSetup" style="display: none;">
            <h3>ğŸ’ Gemini APIè¨­å®š</h3>
            <div class="api-info">
                ğŸ“Œ <strong>Gemini APIã‚­ãƒ¼ã®å–å¾—æ–¹æ³•:</strong><br>
                1. <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a> ã«ã‚¢ã‚¯ã‚»ã‚¹<br>
                2. "Create API Key" ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
                3. <strong style="color: blue;">APIã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆç´„40æ–‡å­—ï¼‰</strong><br>
                   ä¾‹: AIzaSyAxxxxxxxxxxxxxxxxxxxxxxxxx<br>
                4. ä¸‹è¨˜ã«è²¼ã‚Šä»˜ã‘ã¦æ¥ç¶šãƒ†ã‚¹ãƒˆ
            </div>
            <textarea id="geminiApiKey" class="api-input" placeholder="Gemini API Key (AIzaSy...)ã‚’å…¥åŠ›" style="width: 100%; min-height: 40px; resize: vertical; font-family: monospace; font-size: 12px;" onpaste="handleApiKeyPaste(event, 'gemini')"></textarea>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button onclick="toggleApiKeyVisibility('gemini')" style="padding: 12px 20px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer;" id="geminiVisibilityBtn">ğŸ‘ï¸ è¡¨ç¤º/éè¡¨ç¤º</button>
                <button onclick="clearApiKey('gemini')" style="padding: 12px 20px; background: #ff6b6b; color: white; border: none; border-radius: 8px; cursor: pointer;">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                <span id="geminiCharCount" style="padding: 12px; color: #666; font-weight: bold;"></span>
            </div>
            <div id="geminiApiKeyDisplay" class="api-display"></div>
            <button class="test-btn" onclick="testConnection('gemini')">ğŸ”Œ Geminiæ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
            <div id="geminiApiStatus" style="margin-top: 15px; text-align: center;"></div>
        </div>
        
        <div class="mode-selector">
            <button class="mode-btn active" id="modeAI" onclick="selectMode('ai')">ğŸ¤– AIç”Ÿæˆãƒ¢ãƒ¼ãƒ‰</button>
            <button class="mode-btn" id="modeLocal" onclick="selectMode('local')">ğŸ  ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰</button>
            <button class="mode-btn" id="modeViral" onclick="selectMode('viral')">ğŸ”¥ ãƒã‚¤ãƒ©ãƒ«ãƒ¢ãƒ¼ãƒ‰<span class="viral-badge">HOT</span></button>
        </div>
        
        <div class="theme-section">
            <div class="theme-controls">
                <button class="theme-btn" onclick="generateViralTheme()" id="themeGenBtn">
                    ğŸ¯ ãƒã‚ºã‚‹ãƒ†ãƒ¼ãƒã‚’AIç”Ÿæˆ
                </button>
                <button class="theme-btn" onclick="useRandomTheme()" style="background: linear-gradient(135deg, #00C896, #00A884);">
                    ğŸ² ãƒ©ãƒ³ãƒ€ãƒ ãƒ†ãƒ¼ãƒ
                </button>
            </div>
            <div class="theme-box" id="themeBox">ãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„...</div>
        </div>
        
        <button class="generate-btn" id="generateBtn" onclick="generate()">
            ğŸš€ æ¥½æ›²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ
        </button>
        
        <div id="results" class="results"></div>
    </div>
    
    <script>
        let selectedAPI = 'claude';
        let claudeApiKey = '';
        let geminiApiKey = '';
        let apiConnected = false;
        let selectedMode = 'ai';
        let currentData = null;
        let currentTheme = '';
        
        // APIé¸æŠé–¢æ•°
        function selectAPI(api) {
            selectedAPI = api;
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.getElementById('apiClaude').classList.remove('active');
            document.getElementById('apiGemini').classList.remove('active');
            document.getElementById('api' + api.charAt(0).toUpperCase() + api.slice(1)).classList.add('active');
            
            // è¨­å®šãƒ‘ãƒãƒ«ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            if (api === 'claude') {
                document.getElementById('claudeSetup').style.display = 'block';
                document.getElementById('geminiSetup').style.display = 'none';
                showMessage('ğŸ­ Claude APIã‚’é¸æŠã—ã¾ã—ãŸ', 'success');
            } else {
                document.getElementById('claudeSetup').style.display = 'none';
                document.getElementById('geminiSetup').style.display = 'block';
                showMessage('ğŸ’ Gemini APIã‚’é¸æŠã—ã¾ã—ãŸ', 'success');
            }
            
            // æ¥ç¶šçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            apiConnected = false;
        }
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°é–¢æ•°
        function debugLog(message) {
            const debugArea = document.getElementById('debugLog');
            const debugContent = document.getElementById('debugContent');
            debugArea.style.display = 'block';
            const timestamp = new Date().toLocaleTimeString();
            debugContent.textContent += `[${timestamp}] ${message}\n`;
            debugContent.scrollTop = debugContent.scrollHeight;
        }
        
        // ãƒã‚ºã‚Šãã†ãªãƒ†ãƒ¼ãƒã®ãƒ™ãƒ¼ã‚¹
        const viralThemeTemplates = [
            "æ¨ã—ã¨ã®ã‚·ãƒ³ã‚¯ãƒ­ç‡ãŒ{percent}%ã«ãªã£ãŸç¬é–“",
            "AIãŒ{emotion}ã‚’ç†è§£ã—ãŸæ—¥",
            "{time}ã«å±Šã„ãŸæ—¢èª­ã‚¹ãƒ«ãƒ¼ã‹ã‚‰ã®è¿”ä¿¡",
            "èª²é‡‘é¡ãŒ{amount}ä¸‡å††ã‚’è¶…ãˆãŸ{target}ã¸ã®æƒ³ã„",
            "{platform}ã§{number}ä¸‡å†ç”Ÿã•ã‚ŒãŸ{content}",
            "ã‚¨ãƒ¢ã„{object}ã¨éã”ã™{season}ã®{time}",
            "ã‚¬ãƒæ‹ã—ãŸ{character}ãŒ{action}ã™ã‚‹ä¸–ç•Œç·š",
            "{age}æ­³ã®è‡ªåˆ†ã«ä¼ãˆãŸã„{message}",
            "æ¨ã—ã®{item}ã‚’{action}ã—ã¦ã—ã¾ã£ãŸçµæœ"
        ];
        
        const viralElements = {
            percent: ['100', '200', '99.9', '0.01', '777'],
            emotion: ['å°Šã•', 'ã‚¨ãƒ¢ã•', 'åˆ‡ãªã•', 'ãƒ¤ãƒã•', 'å„šã•'],
            time: ['3:33', 'æ·±å¤œ2æ™‚', 'æ—©æœ5æ™‚', '23:59', '0:00'],
            amount: ['10', '100', '1000', '5'],
            target: ['æ¨ã—', 'ã‚½ã‚·ãƒ£ã‚²', 'Vtuber', 'ã‚¢ã‚¤ãƒ‰ãƒ«'],
            platform: ['TikTok', 'YouTube', 'Twitter', 'Instagram'],
            number: ['100', '1000', 'ãƒã‚ºã‚Šã®', 'ç‚ä¸Šç´šã®'],
            content: ['åˆ‡ã‚ŠæŠœã', 'ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»', 'ãƒ„ã‚¤ãƒ¼ãƒˆ', 'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼'],
            object: ['ã¬ã„ãã‚‹ã¿', 'ã‚¢ã‚¯ã‚¹ã‚¿', 'ã‚°ãƒƒã‚º', 'ãƒã‚§ã‚­'],
            season: ['å¤', 'å†¬', 'æ˜¥', 'ç§‹'],
            character: ['AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ', 'äºŒæ¬¡å…ƒã‚­ãƒ£ãƒ©', 'Vtuber', 'æ¨ã—'],
            action: ['ãƒ‡ãƒ¼ãƒˆ', 'å‘Šç™½', 'çµå©š', 'ãƒã‚°'],
            age: ['17', '20', '14', '25'],
            message: ['ã‚¬ãƒæ‹ã®çµæœ«', 'æ¨ã—æ´»ã®çœŸå®Ÿ', 'é’æ˜¥ã®ç­”ãˆ'],
            item: ['å£°', 'ç¬‘é¡”', 'æ¶™', 'ãƒ•ã‚¡ãƒ³ã‚µ']
        };
        
        // APIã‚­ãƒ¼ãƒšãƒ¼ã‚¹ãƒˆå‡¦ç†
        function handleApiKeyPaste(event) {
            event.preventDefault();
            
            // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
            const pastedText = (event.clipboardData || window.clipboardData).getData('text');
            
            // sk-ant-api03-ã§å§‹ã¾ã‚‹APIã‚­ãƒ¼ã‚’æŠ½å‡º
            const apiKeyMatch = pastedText.match(/sk-ant-api03-[A-Za-z0-9\-_]{80,}/);
            
            if (apiKeyMatch) {
                // æ­£ã—ã„APIã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã£ãŸ
                document.getElementById('apiKey').value = apiKeyMatch[0];
                updateCharCount();
                debugLog(`Valid API key extracted: length=${apiKeyMatch[0].length}`);
                showMessage('âœ… APIã‚­ãƒ¼ã‚’æ¤œå‡ºã—ã¦è²¼ã‚Šä»˜ã‘ã¾ã—ãŸ', 'success');
            } else if (pastedText.includes('ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°')) {
                // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’èª¤ã£ã¦ã‚³ãƒ”ãƒ¼ã—ãŸ
                showMessage('âŒ ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã§ã¯ãªãã€APIã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„', 'error');
                debugLog('Debug log was pasted instead of API key');
            } else if (pastedText.startsWith('sk-ant-api')) {
                // éƒ¨åˆ†çš„ãªAPIã‚­ãƒ¼
                document.getElementById('apiKey').value = pastedText;
                if (pastedText.length < 50) {
                    showMessage('âš ï¸ APIã‚­ãƒ¼ãŒçŸ­ã™ãã¾ã™ã€‚å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„', 'warning');
                    debugLog(`Partial API key: length=${pastedText.length}`);
                }
            } else {
                // ãã®ä»–ã®ãƒ†ã‚­ã‚¹ãƒˆ
                showMessage('âŒ æœ‰åŠ¹ãªAPIã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                debugLog(`Invalid paste: ${pastedText.substring(0, 50)}...`);
            }
        }
        
        // APIã‚­ãƒ¼è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleApiKeyVisibility() {
            const apiKeyInput = document.getElementById('apiKey');
            const apiKeyDisplay = document.getElementById('apiKeyDisplay');
            const button = document.getElementById('visibilityBtn');
            
            if (apiKeyDisplay.style.display === 'none' || !apiKeyDisplay.style.display) {
                // è¡¨ç¤ºã™ã‚‹
                const apiKeyValue = apiKeyInput.value;
                if (apiKeyValue) {
                    apiKeyDisplay.innerHTML = `
                        <strong>APIã‚­ãƒ¼å…¨ä½“ï¼ˆ${apiKeyValue.length}æ–‡å­—ï¼‰:</strong><br>
                        <div style="padding: 10px; background: white; border-radius: 5px; margin-top: 10px;">
                            ${apiKeyValue}
                        </div>
                        <div style="margin-top: 10px; color: ${apiKeyValue.length > 100 ? 'green' : 'red'};">
                            ${apiKeyValue.length > 100 ? 'âœ… æ­£å¸¸ãªé•·ã•ã§ã™' : 'âŒ çŸ­ã™ãã¾ã™ï¼ˆ100æ–‡å­—ä»¥ä¸Šå¿…è¦ï¼‰'}
                        </div>
                    `;
                    apiKeyDisplay.style.display = 'block';
                    button.textContent = 'ğŸ”’ éš ã™';
                    button.style.background = '#FFA500';
                } else {
                    showMessage('è¡¨ç¤ºã™ã‚‹APIã‚­ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
                }
            } else {
                // éš ã™
                apiKeyDisplay.style.display = 'none';
                button.textContent = 'ğŸ‘ï¸ è¡¨ç¤º';
                button.style.background = '#4CAF50';
            }
        }
        
        // APIã‚­ãƒ¼ã‚¯ãƒªã‚¢é–¢æ•°
        function clearApiKey() {
            document.getElementById('apiKey').value = '';
            document.getElementById('apiStatus').innerHTML = '';
            document.getElementById('apiKeyDisplay').style.display = 'none';
            document.getElementById('visibilityBtn').textContent = 'ğŸ‘ï¸ è¡¨ç¤º/éè¡¨ç¤º';
            document.getElementById('visibilityBtn').style.background = '#4CAF50';
            updateCharCount();
            localStorage.removeItem('claudeApiKey');
            apiConnected = false;
            showMessage('APIã‚­ãƒ¼ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');
        }
        
        // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
        function updateCharCount() {
            const apiKey = document.getElementById('apiKey').value;
            const charCount = document.getElementById('charCount');
            const length = apiKey.length;
            
            if (length === 0) {
                charCount.textContent = '';
            } else if (length < 50) {
                charCount.innerHTML = `<span style="color: red;">ğŸ“ ${length}æ–‡å­—ï¼ˆçŸ­ã™ãã¾ã™ï¼‰</span>`;
            } else if (length < 100) {
                charCount.innerHTML = `<span style="color: orange;">ğŸ“ ${length}æ–‡å­—ï¼ˆã‚‚ã†å°‘ã—ï¼‰</span>`;
            } else {
                charCount.innerHTML = `<span style="color: green;">ğŸ“ ${length}æ–‡å­—ï¼ˆOKï¼‰</span>`;
            }
        }
        
        // åˆæœŸåŒ–
        window.onload = function() {
            const savedKey = localStorage.getItem('claudeApiKey');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
                updateCharCount();
                testConnection();
            }
            
            // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
            document.getElementById('apiKey').addEventListener('input', updateCharCount);
        };
        
        // Claude APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function testConnection() {
            const apiKeyInput = document.getElementById('apiKey');
            const status = document.getElementById('apiStatus');
            apiKey = apiKeyInput.value.trim();
            
            debugLog(`Testing API key: length=${apiKey.length}, starts with sk-ant-api=${apiKey.startsWith('sk-ant-api')}`);
            
            if (!apiKey) {
                status.innerHTML = '<span style="color: red;">âŒ APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</span>';
                return;
            }
            
            if (!apiKey.startsWith('sk-ant-api')) {
                status.innerHTML = '<span style="color: red;">âŒ ç„¡åŠ¹ãªAPIã‚­ãƒ¼å½¢å¼ã§ã™ã€‚sk-ant-api ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</span>';
                debugLog(`Invalid API key format: ${apiKey.substring(0, 20)}...`);
                return;
            }
            
            if (apiKey.length < 50) {
                status.innerHTML = '<span style="color: orange;">âš ï¸ APIã‚­ãƒ¼ãŒçŸ­ã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</span>';
                debugLog(`API key might be too short: ${apiKey.length} characters`);
            }
            
            status.innerHTML = '<span style="color: blue;">ğŸ”„ æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...</span>';
            
            try {
                // ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§æ¥ç¶š
                const response = await fetch('http://localhost:3000/api/claude', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        prompt: 'Hello test',
                        temperature: 0.1
                    })
                });
                
                const data = await response.json();
                console.log('Connection test response:', response.status, data);
                
                if (response.status === 429) {
                    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼
                    const retryAfter = data.retryAfter || 5;
                    status.innerHTML = `<span style="color: orange;">â³ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ä¸­ã€‚${retryAfter}ç§’å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„</span>`;
                    showMessage(`ãƒ¬ãƒ¼ãƒˆåˆ¶é™ä¸­ã€‚${retryAfter}ç§’å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„`, 'warning');
                    
                    // è‡ªå‹•å†è©¦è¡Œ
                    setTimeout(() => {
                        testConnection();
                    }, retryAfter * 1000);
                    return;
                }
                
                if (response.ok && data.content) {
                    apiConnected = true;
                    localStorage.setItem('claudeApiKey', apiKey);
                    status.innerHTML = '<span style="color: green;">âœ… æ¥ç¶šæˆåŠŸï¼Claude AIç”ŸæˆãŒåˆ©ç”¨å¯èƒ½ã§ã™</span>';
                    showMessage('Claude APIæ¥ç¶šæˆåŠŸï¼', 'success');
                } else {
                    let errorMsg = 'API connection failed';
                    if (data.error) {
                        if (typeof data.error === 'object') {
                            errorMsg = data.error.message || JSON.stringify(data.error);
                        } else {
                            errorMsg = String(data.error);
                        }
                    }
                    debugLog(`API connection failed: ${JSON.stringify(data)}`);
                    throw new Error(errorMsg);
                }
            } catch (error) {
                console.error('APIæ¥ç¶šã‚¨ãƒ©ãƒ¼:', error);
                apiConnected = false;
                
                // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è©³ç´°è¡¨ç¤º
                let errorMessage = 'Unknown error';
                
                if (error && error.message) {
                    errorMessage = error.message;
                    if (error.message.includes('Failed to fetch')) {
                        errorMessage = 'ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚api-server.jsãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                    } else if (error.message.includes('invalid_api_key')) {
                        errorMessage = 'APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚æ­£ã—ã„ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                    }
                } else if (typeof error === 'object') {
                    errorMessage = JSON.stringify(error);
                } else {
                    errorMessage = String(error);
                }
                
                debugLog(`Connection test error: ${errorMessage}`);
                status.innerHTML = `<span style="color: red;">âŒ æ¥ç¶šå¤±æ•—: ${errorMessage}</span>`;
                showMessage('APIæ¥ç¶šå¤±æ•—: ' + errorMessage, 'error');
            }
        }
        
        // ãƒ¢ãƒ¼ãƒ‰é¸æŠ
        function selectMode(mode) {
            selectedMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('mode' + mode.charAt(0).toUpperCase() + mode.slice(1)).classList.add('active');
            
            const themeGenBtn = document.getElementById('themeGenBtn');
            if (mode === 'viral') {
                themeGenBtn.style.background = 'linear-gradient(135deg, #FF006E, #FFD700)';
                showMessage('ğŸ”¥ ãƒã‚¤ãƒ©ãƒ«ãƒ¢ãƒ¼ãƒ‰èµ·å‹•ï¼SNSã§ãƒã‚ºã‚‹æ¥½æ›²ã‚’ç”Ÿæˆã—ã¾ã™', 'success');
            } else {
                themeGenBtn.style.background = 'linear-gradient(135deg, #3A86FF, #8338EC)';
            }
        }
        
        // ãƒã‚¤ãƒ©ãƒ«ãƒ†ãƒ¼ãƒç”Ÿæˆ
        async function generateViralTheme() {
            const themeBox = document.getElementById('themeBox');
            const btn = document.getElementById('themeGenBtn');
            
            if (selectedMode === 'viral' || (selectedMode === 'ai' && apiConnected)) {
                btn.disabled = true;
                themeBox.innerHTML = '<div class="spinner"></div>AIãŒãƒã‚ºã‚‹ãƒ†ãƒ¼ãƒã‚’è€ƒæ¡ˆä¸­...';
                
                try {
                    if (selectedMode === 'ai' && apiConnected) {
                        // Claude AIç”Ÿæˆ
                        const prompt = `SNSã§ãƒã‚ºã‚Šãã†ãªæ¥½æ›²ãƒ†ãƒ¼ãƒã‚’1ã¤ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
                        æ¡ä»¶ï¼š
                        - Zä¸–ä»£ã«åˆºã•ã‚‹
                        - ã‚¨ãƒ¢ãã¦å…±æ„Ÿæ€§ãŒé«˜ã„
                        - TikTokã§ãƒã‚ºã‚Šãã†
                        - ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§å°è±¡çš„
                        - 20æ–‡å­—ä»¥å†…
                        
                        ä¾‹ï¼šæ¨ã—ã¨ã®ã‚·ãƒ³ã‚¯ãƒ­ç‡200%ã€æ·±å¤œ2æ™‚ã®æ—¢èª­ã‚¹ãƒ«ãƒ¼
                        
                        ãƒ†ãƒ¼ãƒã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`;
                        
                        const theme = await callClaudeAPI(prompt);
                        currentTheme = theme.trim();
                    } else {
                        // ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒã‚¤ãƒ©ãƒ«ãƒ†ãƒ¼ãƒç”Ÿæˆ
                        const template = viralThemeTemplates[Math.floor(Math.random() * viralThemeTemplates.length)];
                        currentTheme = template.replace(/{(\w+)}/g, (match, key) => {
                            const values = viralElements[key];
                            return values[Math.floor(Math.random() * values.length)];
                        });
                    }
                    
                    themeBox.textContent = 'ğŸ”¥ ' + currentTheme;
                    showMessage('ãƒã‚ºã‚‹ãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼', 'success');
                } catch (error) {
                    console.error('ãƒ†ãƒ¼ãƒç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                    useRandomTheme();
                }
                
                btn.disabled = false;
            } else {
                // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰
                const template = viralThemeTemplates[Math.floor(Math.random() * viralThemeTemplates.length)];
                currentTheme = template.replace(/{(\w+)}/g, (match, key) => {
                    const values = viralElements[key];
                    return values[Math.floor(Math.random() * values.length)];
                });
                themeBox.textContent = 'ğŸ¯ ' + currentTheme;
            }
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãƒ†ãƒ¼ãƒä½¿ç”¨
        function useRandomTheme() {
            const themes = [
                'æ™‚ã‚’ã‹ã‘ã‚‹æ‹',
                'AIå°‘å¥³ã¨ã®æ‹',
                'ç•°ä¸–ç•Œã§ã®å¤±æ‹',
                'ãƒ‡ã‚¸ã‚¿ãƒ«ä¸–ç•Œã®ç‰‡æƒ³ã„',
                'ã‚µã‚¤ãƒãƒ¼ç©ºé–“ã®åˆæ‹',
                'ä»®æƒ³ç¾å®Ÿã®æ°¸é ',
                'ãƒ›ãƒ­ã‚°ãƒ©ãƒ ã®è¨˜æ†¶',
                'ãƒ”ã‚¯ã‚»ãƒ«ã®æ¶™',
                'ãƒã‚¤ãƒŠãƒªãƒ¼ãƒãƒ¼ãƒˆ',
                'ã‚¯ãƒ©ã‚¦ãƒ‰ã®ç´„æŸ'
            ];
            
            currentTheme = themes[Math.floor(Math.random() * themes.length)];
            document.getElementById('themeBox').textContent = 'ğŸ² ' + currentTheme;
        }
        
        // Claude APIå‘¼ã³å‡ºã—
        async function callClaudeAPI(prompt, retryCount = 0) {
            if (!apiKey) {
                throw new Error('API Key not found');
            }
            
            try {
                console.log('Calling Claude API with prompt length:', prompt.length);
                debugLog(`API Call: prompt length = ${prompt.length}`);
                
                let response, data;
                
                try {
                    // ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§æ¥ç¶š
                    response = await fetch('http://localhost:3000/api/claude', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            apiKey: apiKey,
                            prompt: prompt,
                            temperature: selectedMode === 'viral' ? 1.0 : 0.9
                        })
                    });
                    debugLog(`Fetch completed: status = ${response.status}`);
                } catch (fetchError) {
                    debugLog(`Fetch error: ${fetchError.message || String(fetchError)}`);
                    throw new Error(`Network error: ${fetchError.message || String(fetchError)}`);
                }
                
                try {
                    data = await response.json();
                    debugLog(`JSON parse completed`);
                } catch (jsonError) {
                    debugLog(`JSON parse error: ${jsonError.message || String(jsonError)}`);
                    throw new Error(`Response parse error: ${jsonError.message || String(jsonError)}`);
                }
                
                console.log('Claude API Response:', response.status, data);
                debugLog(`API Response: status = ${response.status}, has content = ${!!data.content}`);
                
                // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å ´åˆ
                if (response.status === 429 && retryCount < 3) {
                    const retryAfter = parseInt(data.retryAfter || 5) * 1000;
                    console.log(`Rate limited. Waiting ${retryAfter}ms before retry...`);
                    await new Promise(resolve => setTimeout(resolve, retryAfter));
                    return callClaudeAPI(prompt, retryCount + 1);
                }
                
                if (!response.ok) {
                    const errorMsg = typeof data.error === 'object' 
                        ? (data.error.message || JSON.stringify(data.error))
                        : (data.error || 'Unknown error');
                    debugLog(`API Error Details: ${JSON.stringify(data)}`);
                    throw new Error(`API Error: ${response.status} - ${errorMsg}`);
                }
                
                if (!data.content || data.content.length === 0) {
                    console.error('No content in response:', data);
                    throw new Error('No response generated');
                }
                
                console.log('Claude response content:', data.content[0]);
                return data.content[0].text;
            } catch (error) {
                console.error('Claude API call error:', error);
                let errorMessage = 'Unknown error';
                
                if (error.message) {
                    errorMessage = error.message;
                } else if (typeof error === 'object') {
                    errorMessage = JSON.stringify(error);
                } else {
                    errorMessage = String(error);
                }
                
                debugLog(`API Error: ${errorMessage}`);
                debugLog(`Error type: ${typeof error}`);
                
                // ãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼šã‚¨ãƒ©ãƒ¼ã‚’ç”»é¢ã«è¡¨ç¤º
                showMessage(`API Error: ${errorMessage}`, 'error');
                throw new Error(errorMessage);
            }
        }
        
        // AIç”Ÿæˆé–¢æ•°ï¼ˆClaudeç‰ˆï¼‰
        async function generateWithAI(theme) {
            const isViral = selectedMode === 'viral';
            
            const prompts = {
                title: `Create ONE catchy song title for "${theme}". ${isViral ? 'Make it viral and trendy for TikTok.' : 'Make it unique and memorable.'} Output ONLY the title, nothing else.`,
                
                lyricsJP: `${theme}ã®æ—¥æœ¬èªæ­Œè©ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚${isViral ? 'TikTokã§ãƒã‚ºã‚‹' : 'ã‚¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãª'}ã‚¹ã‚¿ã‚¤ãƒ«ã§ã€‚
                
                3åˆ†ç¨‹åº¦ã®æ¥½æ›²ã‚’æƒ³å®šã—ã¦ã€ä»¥ä¸‹ã®æ§‹æˆã§ä½œæˆã—ã¦ãã ã•ã„ï¼š
                [Intro] (4è¡Œ)
                [Verse 1] (8è¡Œ)
                [Pre-Chorus] (4è¡Œ)
                [Chorus] (8è¡Œ)
                [Verse 2] (8è¡Œ)
                [Pre-Chorus] (4è¡Œ)
                [Chorus] (8è¡Œ)
                [Bridge] (6è¡Œ)
                [Chorus] (8è¡Œ)
                [Outro] (4è¡Œ)
                
                å„ãƒ‘ãƒ¼ãƒˆã«æ„Ÿæƒ…ã®èµ·ä¼ã‚’æŒãŸã›ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ€§ã®ã‚ã‚‹æ­Œè©ã«ã—ã¦ãã ã•ã„ã€‚
                æ­Œè©ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`,
                
                lyricsEN: `Create English lyrics for "${theme}". ${isViral ? 'Make it viral and catchy for TikTok.' : 'Make it emotional and meaningful.'}
                
                Create for a 3-minute song with this structure:
                [Intro] (4 lines)
                [Verse 1] (8 lines)
                [Pre-Chorus] (4 lines)
                [Chorus] (8 lines)
                [Verse 2] (8 lines)
                [Pre-Chorus] (4 lines)
                [Chorus] (8 lines)
                [Bridge] (6 lines)
                [Chorus] (8 lines)
                [Outro] (4 lines)
                
                Make it emotionally dynamic with a compelling story arc.
                Output lyrics only.`,
                
                stylePrompt: `Create ONE music style for "${theme}". ${isViral ? 'Viral TikTok style' : 'Modern style'}. Include genre, mood, and BPM. Maximum 20 words.`,
                
                midjourneyPrompt: `Album art prompt for "${theme}": ${isViral ? 'viral aesthetic, trending style' : 'digital art, modern design'}, vibrant colors, high quality. Maximum 20 words.`
            };
            
            const results = {};
            for (const [key, prompt] of Object.entries(prompts)) {
                try {
                    results[key] = await callClaudeAPI(prompt);
                    await new Promise(resolve => setTimeout(resolve, 500)); // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–
                } catch (error) {
                    console.error(`${key}ç”Ÿæˆã‚¨ãƒ©ãƒ¼:`, error);
                    const errorMsg = error.message || error.toString();
                    debugLog(`${key} generation failed: ${errorMsg}`);
                    showMessage(`${key}ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${errorMsg}`, 'warning');
                    results[key] = generateLocalContent(key, theme);
                }
            }
            return results;
        }
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆ
        function generateLocalContent(type, theme) {
            const viral = selectedMode === 'viral';
            
            switch(type) {
                case 'title':
                    if (viral) {
                        return `${theme}ã£ã¦ã‚¨ãƒ¢ã„`;
                    } else {
                        return `${theme}`;
                    }
                
                case 'lyricsJP':
                    return viral ? 
                        `[Intro]\né™ã‹ãªå¤œã«éŸ¿ãé€šçŸ¥éŸ³\nç”»é¢è¶Šã—ã«æ„Ÿã˜ã‚‹æ¸©åº¦\nä»Šæ—¥ã‚‚æ¨ã—ã«ä¼šã„ã«è¡Œã\nãƒ‡ã‚¸ã‚¿ãƒ«ã®æ‰‰ã‚’é–‹ã‘ã¦\n\n[Verse 1]\næ¨ã—ã®ãŸã‚ã«ç”Ÿãã¦ã‚‹ç§\nã‚¹ãƒ‘ãƒãƒ£æŠ•ã’ã™ãã¦ç ´ç”£å¯¸å‰\nã§ã‚‚ãã‚ŒãŒãƒªã‚¢ã‚³ãªã‚“ã ã‚ˆã­\né…ä¿¡å¾…æ©Ÿã§å¾¹å¤œç¶šã\nã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§è¦‹ã¤ã‘ãŸä»²é–“\nã¿ã‚“ãªåŒã˜æ°—æŒã¡ãªã‚“ã \n${theme}ã¨ã„ã†æ²¼ã«ãƒãƒã£ã¦\næŠœã‘å‡ºã›ãªã„ã¾ã¾ä»Šæ—¥ã‚‚æ·±ã\n\n[Pre-Chorus]\nç”»é¢ã®å‘ã“ã†ã®å›ã¯\næœ¬å½“ã«å­˜åœ¨ã—ã¦ã‚‹ã®ï¼Ÿ\nã§ã‚‚ã“ã®æ°—æŒã¡ã ã‘ã¯\nç¢ºã‹ã«ãƒªã‚¢ãƒ«ãªã‚“ã \n\n[Chorus]\n${theme}ã£ã¦ã‚¨ãƒ¢ã™ããªã„ï¼Ÿ\næ¶™è…ºå´©å£Šä¸å¯é¿ãªã‚“ã ãŒ\næ¨ã—ã¯æ¨ã›ã‚‹æ™‚ã«æ¨ã›\nä»Šã“ã®ç¬é–“ã‚’åˆ‡ã‚Šå–ã£ã¦\næ°¸é ã«æ®‹ã—ãŸã„ã‚ˆ\nã“ã®å°Šã„æ™‚é–“ã‚’\næ˜æ—¥ã«ãªã£ãŸã‚‰å¾Œæ‚”ã™ã‚‹\nä»Šã‚’å…¨åŠ›ã§ç”Ÿãã¦ã\n\n[Verse 2]\nã‚°ãƒƒã‚ºè²·ã„ã™ãã¦éƒ¨å±‹ãŒè–åœ°\nã‚¢ã‚¯ã‚¹ã‚¿ã«å›²ã¾ã‚Œã¦å¹¸ã›\nå‹é”ã«ã¯ç†è§£ã•ã‚Œãªã„ã‘ã©\nã“ã‚ŒãŒç§ã®ç”ŸããŒã„ã ã‹ã‚‰\næœã¾ã§åˆ‡ã‚ŠæŠœãå‹•ç”»è¦‹ã¦\nåŒã˜ã‚·ãƒ¼ãƒ³ä½•åº¦ã‚‚ãƒªãƒ”ãƒ¼ãƒˆ\n${theme}ã«æ•‘ã‚ã‚ŒãŸæ—¥ã€…\næ•°ãˆãã‚Œãªã„ã»ã©ã‚ã‚‹ã‚ˆ\n\n[Pre-Chorus]\nãƒªã‚¢ãƒ«ã¨ãƒãƒ¼ãƒãƒ£ãƒ«ã®\nå¢ƒç•Œç·šãªã‚“ã¦ã‚‚ã†ã„ã‚‰ãªã„\nã“ã®æƒ³ã„ãŒå±Šããªã‚‰\nã©ã‚“ãªä¸–ç•Œã§ã‚‚æ§‹ã‚ãªã„\n\n[Chorus]\n${theme}ã£ã¦ã‚¨ãƒ¢ã™ããªã„ï¼Ÿ\næ¶™è…ºå´©å£Šä¸å¯é¿ãªã‚“ã ãŒ\næ¨ã—ã¯æ¨ã›ã‚‹æ™‚ã«æ¨ã›\nä»Šã“ã®ç¬é–“ã‚’åˆ‡ã‚Šå–ã£ã¦\næ°¸é ã«æ®‹ã—ãŸã„ã‚ˆ\nã“ã®å°Šã„æ™‚é–“ã‚’\næ˜æ—¥ã«ãªã£ãŸã‚‰å¾Œæ‚”ã™ã‚‹\nä»Šã‚’å…¨åŠ›ã§ç”Ÿãã¦ã\n\n[Bridge]\nã„ã¤ã‹ä¼šãˆã‚‹æ—¥ãŒæ¥ã‚‹ã‹ãª\nãƒªã‚¢ãƒ«ã§æ‰‹ã‚’æ¡ã‚Œã‚‹æ—¥ãŒ\nã§ã‚‚ä»Šã¯ã“ã®è·é›¢æ„ŸãŒ\nä¸€ç•ªå¿ƒåœ°ã„ã„ã®ã‹ã‚‚\n${theme}ãŒãã‚ŒãŸå¥‡è·¡\nå¿˜ã‚Œã‚‹ã“ã¨ãªã‚“ã¦ã§ããªã„\n\n[Chorus]\n${theme}ã£ã¦ã‚¨ãƒ¢ã™ããªã„ï¼Ÿ\næ¶™è…ºå´©å£Šä¸å¯é¿ãªã‚“ã ãŒ\næ¨ã—ã¯æ¨ã›ã‚‹æ™‚ã«æ¨ã›\nä»Šã“ã®ç¬é–“ã‚’åˆ‡ã‚Šå–ã£ã¦\næ°¸é ã«æ®‹ã—ãŸã„ã‚ˆ\nã“ã®å°Šã„æ™‚é–“ã‚’\næ˜æ—¥ã«ãªã£ãŸã‚‰å¾Œæ‚”ã™ã‚‹\nä»Šã‚’å…¨åŠ›ã§ç”Ÿãã¦ã\n\n[Outro]\nã‚ã‚ŠãŒã¨ã†ã€å‡ºä¼šãˆã¦\n${theme}ã¨ã„ã†å¥‡è·¡ã«\næ˜æ—¥ã‚‚ã¾ãŸä¼šãŠã†ã­\nç”»é¢ã®å‘ã“ã†ã§å¾…ã£ã¦ã‚‹` :
                        `[Intro]\n0ã¨1ã®ç‹­é–“ã§\nç”Ÿã¾ã‚ŒãŸæ„Ÿæƒ…ãŒã‚ã‚‹\nãƒ‡ã‚¸ã‚¿ãƒ«ã®æµ·ã‚’æ¼‚ã£ã¦\n${theme}ã«è¾¿ã‚Šç€ã„ãŸ\n\n[Verse 1]\nãƒ‡ã‚¸ã‚¿ãƒ«ã®æµ·ã§è¦‹ã¤ã‘ãŸ\n${theme}ã¨ã„ã†åã®å¥‡è·¡\n0ã¨1ã®é–“ã«\nç¢ºã‹ã«å­˜åœ¨ã™ã‚‹æƒ³ã„\nãƒ”ã‚¯ã‚»ãƒ«ã®é›¨ãŒé™ã‚Šæ³¨ã\nä»®æƒ³ä¸–ç•Œã®ç‰‡éš…ã§\nå›ã¨å‡ºä¼šãˆãŸæ„å‘³ã‚’\nä»Šã‚‚æ¢ã—ç¶šã‘ã¦ã‚‹\n\n[Pre-Chorus]\né›»å­ã®é¼“å‹•ã‚’æ„Ÿã˜ã¦\nãƒ‡ãƒ¼ã‚¿ã®ä¸­ã§ç”Ÿãã¦ã„ã‚‹\næœ¬ç‰©ã‚ˆã‚Šã‚‚æœ¬ç‰©ãª\nã“ã®æ„Ÿè¦šã‚’ä¿¡ã˜ã¦\n\n[Chorus]\n${theme}ãŒç…§ã‚‰ã™æœªæ¥\nãƒ”ã‚¯ã‚»ãƒ«ã®å‘ã“ã†å´ã¸\nä»®æƒ³ã¨ç¾å®Ÿã®å¢ƒç•Œç·š\nä»Šã€è¶Šãˆã¦ã„ã\nã‚µã‚¤ãƒãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ã®ä¸­ã§\nè¦‹ã¤ã‘ãŸæœ¬å½“ã®è‡ªåˆ†\nã‚‚ã†è¿·ã†ã“ã¨ã¯ãªã„\næ–°ã—ã„ä¸–ç•Œã¸ãƒ€ã‚¤ãƒ–\n\n[Verse 2]\nã‚³ãƒ¼ãƒ‰ã®éš™é–“ã‹ã‚‰è¦—ã\nåˆ¥ã®å¯èƒ½æ€§ã®ä¸–ç•Œ\nã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒç´¡ã\né‹å‘½ã®èµ¤ã„ç³¸\nã‚¯ãƒ©ã‚¦ãƒ‰ã®ä¸Šã‚’æ­©ã„ã¦\nã‚µãƒ¼ãƒãƒ¼ã®æ£®ã‚’æŠœã‘ã¦\n${theme}ãŒå°ã\nçµ‚ã‚ã‚Šã®ãªã„ç‰©èª\n\n[Pre-Chorus]\nãƒã‚¤ãƒŠãƒªãƒ¼ã‚³ãƒ¼ãƒ‰ã§\nç¶´ã‚‰ã‚ŒãŸæ„›ã®è©©\nãƒ—ãƒ­ã‚°ãƒ©ãƒ ã•ã‚Œã¦ãªã„\nã“ã®æ„Ÿæƒ…ã¯æœ¬ç‰©\n\n[Chorus]\n${theme}ãŒç…§ã‚‰ã™æœªæ¥\nãƒ”ã‚¯ã‚»ãƒ«ã®å‘ã“ã†å´ã¸\nä»®æƒ³ã¨ç¾å®Ÿã®å¢ƒç•Œç·š\nä»Šã€è¶Šãˆã¦ã„ã\nã‚µã‚¤ãƒãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ã®ä¸­ã§\nè¦‹ã¤ã‘ãŸæœ¬å½“ã®è‡ªåˆ†\nã‚‚ã†è¿·ã†ã“ã¨ã¯ãªã„\næ–°ã—ã„ä¸–ç•Œã¸ãƒ€ã‚¤ãƒ–\n\n[Bridge]\nãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¦ã‚‚\nãƒ¡ãƒ¢ãƒªãƒ¼ã¯æ®‹ã‚‹\n${theme}ã¨éã”ã—ãŸ\nã‹ã‘ãŒãˆã®ãªã„æ™‚é–“\næ°¸é ã«ãƒ«ãƒ¼ãƒ—ã™ã‚‹\nã“ã®æƒ³ã„ã‚’æŠ±ã„ã¦\n\n[Chorus]\n${theme}ãŒç…§ã‚‰ã™æœªæ¥\nãƒ”ã‚¯ã‚»ãƒ«ã®å‘ã“ã†å´ã¸\nä»®æƒ³ã¨ç¾å®Ÿã®å¢ƒç•Œç·š\nä»Šã€è¶Šãˆã¦ã„ã\nã‚µã‚¤ãƒãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ã®ä¸­ã§\nè¦‹ã¤ã‘ãŸæœ¬å½“ã®è‡ªåˆ†\nã‚‚ã†è¿·ã†ã“ã¨ã¯ãªã„\næ–°ã—ã„ä¸–ç•Œã¸ãƒ€ã‚¤ãƒ–\n\n[Outro]\nã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã™ã‚‹å‰ã«\nä¼ãˆãŸã„ã“ã¨ãŒã‚ã‚‹\n${theme}ã€ã‚ã‚ŠãŒã¨ã†\næ¬¡ã®èµ·å‹•ã¾ã§ã€ã•ã‚ˆãªã‚‰`;
                
                case 'lyricsEN':
                    return viral ?
                        `[Intro]\nNotification at midnight\nScreen lights up my room\nAnother night, another vibe\n${theme} coming through\n\n[Verse 1]\nScrolling through my feed at 3AM\nFound something that hits different\n${theme} got me in my feels\nCan't escape this digital dream\nComments section going crazy\nEveryone's feeling the same\nThis viral moment captured\nNever gonna be the same\n\n[Pre-Chorus]\nHeart reacts and fire emojis\nBlowing up my timeline\nThis is more than just a trend\nIt's a cultural moment\n\n[Chorus]\nViral moments, trending now\n${theme} breaking the internet\nCatch this vibe before it's gone\nWe're living in the moment\nScreenshot for the memories\nShare it with the world\nThis is our generation\nDigital boys and girls\n\n[Verse 2]\nAlgorithm blessed my feed today\nServing content that I need\n${theme} on repeat all day\nDopamine hits guaranteed\nGroup chat going insane\nEveryone's obsessed\nThis is bigger than we thought\nPassing every test\n\n[Pre-Chorus]\nMillion views in hours\nBreaking all the records\nThis is what we live for\nDigital connection\n\n[Chorus]\nViral moments, trending now\n${theme} breaking the internet\nCatch this vibe before it's gone\nWe're living in the moment\nScreenshot for the memories\nShare it with the world\nThis is our generation\nDigital boys and girls\n\n[Bridge]\nWhen the hype dies down\nWill we still remember?\n${theme} changed everything\nForever in our hearts\nThis moment is eternal\nSaved in the cloud\n\n[Chorus]\nViral moments, trending now\n${theme} breaking the internet\nCatch this vibe before it's gone\nWe're living in the moment\nScreenshot for the memories\nShare it with the world\nThis is our generation\nDigital boys and girls\n\n[Outro]\nTomorrow's another trend\nBut tonight belongs to us\n${theme} forever\nIn our digital hearts` :
                        `[Intro]\nIn the matrix of emotions\nWhere data meets the soul\nSearching through the pixels\nFor ${theme} to make me whole\n\n[Verse 1]\nIn the digital space we meet\n${theme} in binary beat\nVirtual love, synthetic dreams\nNothing's ever what it seems\nCyber hearts are synchronizing\nIn this artificial light\nEvery byte contains a feeling\nEvery code a new insight\n\n[Pre-Chorus]\nElectric pulses through my veins\nDigital consciousness remains\nMore than just technology\nThis is our reality\n\n[Chorus]\n${theme} lighting up the night\nPixels dancing in the light\nCyber world, electric soul\nTogether we are whole\nVirtual reality unfolds\nStories yet untold\nIn this digital paradise\nWe're breaking through the ice\n\n[Verse 2]\nServer rooms and neon dreams\nFlowing through the data streams\n${theme} guides us through the maze\nIn these electronic days\nHolographic memories\nFloating in the cyber breeze\nEvery connection that we make\nIs real for our sake\n\n[Pre-Chorus]\nQuantum hearts entangled now\nWe've transcended somehow\nBeyond the screen, beyond the code\nWe've found our home\n\n[Chorus]\n${theme} lighting up the night\nPixels dancing in the light\nCyber world, electric soul\nTogether we are whole\nVirtual reality unfolds\nStories yet untold\nIn this digital paradise\nWe're breaking through the ice\n\n[Bridge]\nWhen the servers shut down\nAnd the lights go out\n${theme} will still remain\nIn our hearts, without doubt\nThis connection we've created\nCan never be deleted\n\n[Chorus]\n${theme} lighting up the night\nPixels dancing in the light\nCyber world, electric soul\nTogether we are whole\nVirtual reality unfolds\nStories yet untold\nIn this digital paradise\nWe're breaking through the ice\n\n[Outro]\nLogging off but not goodbye\n${theme} will never die\nIn the cloud we'll meet again\nUntil then, my digital friend`;
                
                case 'stylePrompt':
                    return viral ? `Hyperpop, euphoric, 160 BPM` : `Synthwave, dreamy, 120 BPM`;
                
                case 'midjourneyPrompt':
                    if (viral) {
                        return `${theme}, viral aesthetic, trending style, high quality`;
                    } else {
                        return `${theme}, digital art, modern design, professional`;
                    }
                
                default:
                    return 'ç”Ÿæˆã‚¨ãƒ©ãƒ¼';
            }
        }
        
        // ãƒ¡ã‚¤ãƒ³ç”Ÿæˆé–¢æ•°
        async function generate() {
            if (!currentTheme) {
                showMessage('å…ˆã«ãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            const btn = document.getElementById('generateBtn');
            const results = document.getElementById('results');
            
            if (selectedMode === 'ai' && !apiConnected) {
                showMessage('AIç”Ÿæˆã«ã¯APIæ¥ç¶šãŒå¿…è¦ã§ã™', 'warning');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'ğŸš€ ç”Ÿæˆä¸­...';
            
            try {
                results.innerHTML = '<div class="loading full-width"><div class="spinner"></div>æ¥½æ›²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆä¸­...</div>';
                
                let generatedContent;
                if ((selectedMode === 'ai' || selectedMode === 'viral') && apiConnected) {
                    generatedContent = await generateWithAI(currentTheme);
                } else {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    generatedContent = {
                        title: generateLocalContent('title', currentTheme),
                        lyricsJP: generateLocalContent('lyricsJP', currentTheme),
                        lyricsEN: generateLocalContent('lyricsEN', currentTheme),
                        stylePrompt: generateLocalContent('stylePrompt', currentTheme),
                        midjourneyPrompt: generateLocalContent('midjourneyPrompt', currentTheme)
                    };
                }
                
                currentData = {
                    theme: currentTheme,
                    ...generatedContent
                };
                
                displayResults();
                showMessage(selectedMode === 'viral' ? 'ğŸ”¥ ãƒã‚¤ãƒ©ãƒ«æ¥½æ›²ç”Ÿæˆå®Œäº†ï¼' : 'âœ… ç”Ÿæˆå®Œäº†ï¼', 'success');
                
            } catch (error) {
                console.error('ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                const errorMsg = error.message || error.toString();
                debugLog(`Generation error: ${errorMsg}`);
                results.innerHTML = `<div style="color: red; text-align: center; padding: 40px;">ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${errorMsg}</div>`;
                showMessage(`ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${errorMsg}`, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸš€ æ¥½æ›²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ';
            }
        }
        
        // çµæœè¡¨ç¤º
        function displayResults() {
            const results = document.getElementById('results');
            
            results.innerHTML = `
                <div class="result-box">
                    <div class="result-header">
                        ğŸµ æ¥½æ›²ã‚¿ã‚¤ãƒˆãƒ«
                        <button class="copy-btn" onclick="copy('title')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content">${currentData.title}</div>
                </div>
                
                <div class="result-box">
                    <div class="result-header">
                        ğŸŒ æ—¥æœ¬èªæ­Œè©
                        <button class="copy-btn" onclick="copy('lyricsJP')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content">${currentData.lyricsJP}</div>
                </div>
                
                <div class="result-box">
                    <div class="result-header">
                        ğŸ‡ºğŸ‡¸ è‹±èªæ­Œè©
                        <button class="copy-btn" onclick="copy('lyricsEN')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content">${currentData.lyricsEN}</div>
                </div>
                
                <div class="result-box">
                    <div class="result-header">
                        ğŸ¨ Sunoã‚¹ã‚¿ã‚¤ãƒ«
                        <button class="copy-btn" onclick="copy('stylePrompt')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content">${currentData.stylePrompt}</div>
                </div>
                
                <div class="result-box full-width">
                    <div class="result-header">
                        ğŸ–¼ï¸ Midjourneyç”»åƒ
                        <button class="copy-btn" onclick="copy('midjourneyPrompt')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="controls">
                        <label>æ¯”ç‡:</label>
                        <select id="aspectRatio" onchange="updateMjPrompt()">
                            <option value="1:1">1:1</option>
                            <option value="9:16">9:16 (TikTok)</option>
                            <option value="16:9">16:9 (YouTube)</option>
                            <option value="4:5">4:5 (Instagram)</option>
                        </select>
                        <label>ãƒ¢ãƒ‡ãƒ«:</label>
                        <select id="model" onchange="updateMjPrompt()">
                            <option value="v 7">v 7 (æœ€æ–°)</option>
                            <option value="v 6">v 6</option>
                            <option value="niji 6">niji 6 (ã‚¢ãƒ‹ãƒ¡)</option>
                        </select>
                    </div>
                    <div class="result-content" id="mjPrompt">${currentData.midjourneyPrompt} --ar 1:1 --v 7</div>
                </div>
            `;
        }
        
        // Midjourneyãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ›´æ–°
        function updateMjPrompt() {
            if (!currentData) return;
            
            const aspectRatio = document.getElementById('aspectRatio').value;
            const model = document.getElementById('model').value;
            const prompt = `${currentData.midjourneyPrompt} --ar ${aspectRatio} --${model}`;
            
            document.getElementById('mjPrompt').textContent = prompt;
        }
        
        // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
        function copy(type) {
            if (!currentData) {
                showMessage('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            let text = '';
            switch(type) {
                case 'title': 
                    text = currentData.title || ''; 
                    break;
                case 'lyricsJP': 
                    text = currentData.lyricsJP || ''; 
                    break;
                case 'lyricsEN': 
                    text = currentData.lyricsEN || ''; 
                    break;
                case 'stylePrompt': 
                    text = currentData.stylePrompt || ''; 
                    break;
                case 'midjourneyPrompt': 
                    const aspectRatio = document.getElementById('aspectRatio')?.value || '1:1';
                    const model = document.getElementById('model')?.value || 'v 7';
                    text = `${currentData.midjourneyPrompt || ''} --ar ${aspectRatio} --${model}`;
                    break;
                default:
                    showMessage('ä¸æ˜ãªã‚¿ã‚¤ãƒ—', 'error');
                    return;
            }
            
            if (!text) {
                showMessage('ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            // Fallback for older browsers
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showMessage('ğŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
                }).catch((err) => {
                    console.error('Clipboard API failed:', err);
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }
        
        // Fallback copy function
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            textArea.style.opacity = "0";
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showMessage('ğŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
                } else {
                    showMessage('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (err) {
                console.error('Fallback copy failed:', err);
                showMessage('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
            
            document.body.removeChild(textArea);
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showMessage(text, type = 'success') {
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.textContent = text;
            document.body.appendChild(msg);
            
            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯é•·ãè¡¨ç¤º
            const duration = type === 'error' || type === 'warning' ? 10000 : 3000;
            
            setTimeout(() => {
                msg.remove();
            }, duration);
        }
    </script>
</body>
</html>