<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ AI Suno Creator Studio</title>
    <meta name="theme-color" content="#667eea">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            color: white;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .api-setup {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .api-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .generate-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .big-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 50px;
            border: none;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.3s;
            margin: 10px;
        }
        
        .big-btn:hover:not(:disabled) {
            transform: translateY(-3px);
        }
        
        .big-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            position: relative;
        }
        
        .result-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }
        
        .result-content {
            background: white;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .midjourney-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .control-group label {
            font-size: 12px;
            color: #666;
        }
        
        .control-group select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .theme-display {
            background: #e9ecef;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .theme-text {
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
        }
        
        .saved-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .saved-indicator.show {
            opacity: 1;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .api-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .api-option {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .api-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
            h1 { font-size: 2em; }
            .main-panel { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸµ AI Suno Creator Studio</h1>
            <p class="subtitle">AIç”Ÿæˆã«ã‚ˆã‚‹ç„¡é™ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³æ¥½æ›²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</p>
        </header>
        
        <div class="main-panel">
            <div class="api-setup">
                <h3>ğŸ”§ AIè¨­å®š</h3>
                <div class="api-selector">
                    <div class="api-option selected" onclick="selectAPI('local')">
                        ğŸ  ãƒ­ãƒ¼ã‚«ãƒ«AI (ã‚ªãƒ•ãƒ©ã‚¤ãƒ³)
                    </div>
                    <div class="api-option" onclick="selectAPI('openai')">
                        ğŸ¤– OpenAI (è¦API Key)
                    </div>
                    <div class="api-option" onclick="selectAPI('claude')">
                        ğŸ§  Claude (è¦API Key)
                    </div>
                    <div class="api-option" onclick="selectAPI('gemini')">
                        âœ¨ Gemini (è¦API Key)
                    </div>
                </div>
                <div id="apiKeySection" style="display: none;">
                    <input type="password" id="apiKey" class="api-input" placeholder="API Keyã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                    <small style="color: #666;">API Keyã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®localStorageã«å®‰å…¨ã«ä¿å­˜ã•ã‚Œã¾ã™</small>
                </div>
            </div>
            
            <div class="generate-section">
                <button class="big-btn" onclick="generateAll()" id="generateBtn">ğŸ² AIæ¥½æ›²ç”Ÿæˆ</button>
            </div>
            
            <div class="theme-display" id="themeDisplay">
                <div class="theme-text" id="themeText">ğŸ¯ AIãŒãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆã—ã¾ã™</div>
            </div>
            
            <div class="results-grid" id="resultsGrid">
                <!-- çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
        </div>
    </div>
    
    <div class="saved-indicator" id="savedIndicator">ğŸ’¾ è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã—ãŸ</div>

    <script>
        let selectedAPI = 'local';
        let currentGeneration = null;
        
        // ãƒ†ãƒ¼ãƒãƒ»ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®ãƒ™ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿
        const themeElements = {
            concepts: [
                "æ™‚ã‚’ã‹ã‘ã‚‹æ‹", "AIå°‘å¥³ã¨ã®æ‹", "ç•°ä¸–ç•Œã§ã®å¤±æ‹", "ãƒ¯ãƒ¼ãƒ—ã—ãŸå…ˆã®å›",
                "ãƒ‡ã‚¸ã‚¿ãƒ«ä¸–ç•Œã®ç‰‡æƒ³ã„", "ãƒ«ãƒ¼ãƒ—ã™ã‚‹å‘Šç™½", "AIãŒæ­Œã†å¤±æ‹æ­Œ", "ç•°æ¬¡å…ƒæ‹æ„›äº‹æƒ…",
                "ã‚µã‚¤ãƒãƒ¼ç©ºé–“ã®åˆæ‹", "æ™‚é–“åœæ­¢ä¸­ã®æ‹", "ãƒ›ãƒ­ã‚°ãƒ©ãƒ ã®æ‹äºº", "è¨˜æ†¶ã‚’æ¶ˆã•ã‚ŒãŸæ‹",
                "é‡å­ã‚‚ã¤ã‚Œã®æ„›", "ãƒãƒ¼ãƒãƒ£ãƒ«çµå©šå¼", "ãƒã‚ªãƒ³ãƒ©ã‚¤ãƒˆã®ä¸‹ã§", "ãƒ¡ã‚¿ãƒãƒ¼ã‚¹ã®ç§˜å¯†",
                "ã‚¿ã‚¤ãƒ ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹æ‹æ„›", "AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¸ã®æƒ³ã„", "ç•°ä¸–ç•Œè»¢ç”Ÿå¾Œã®å†ä¼š", "æœªæ¥ã‹ã‚‰ã®æ‰‹ç´™"
            ],
            emotions: [
                "åˆ‡ãªã„", "å¸Œæœ›ã«æº€ã¡ãŸ", "ãƒã‚¹ã‚¿ãƒ«ã‚¸ãƒƒã‚¯ãª", "æƒ…ç†±çš„ãª", "ç¥ç§˜çš„ãª",
                "ãƒ¡ãƒ©ãƒ³ã‚³ãƒªãƒƒã‚¯ãª", "ã‚¨ã‚­ã‚µã‚¤ãƒ†ã‚£ãƒ³ã‚°ãª", "ãƒ‰ãƒªãƒ¼ãƒŸãƒ¼ãª", "ã‚¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãª", "ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãª"
            ],
            settings: [
                "ãƒã‚ªãƒ³è¡—", "ã‚µã‚¤ãƒãƒ¼ç©ºé–“", "æœªæ¥éƒ½å¸‚", "ç•°ä¸–ç•Œ", "å®‡å®™ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³",
                "ãƒ‡ã‚¸ã‚¿ãƒ«å›³æ›¸é¤¨", "ãƒãƒ¼ãƒãƒ£ãƒ«ã‚«ãƒ•ã‚§", "æ™‚ç©ºã®ç‹­é–“", "AIç ”ç©¶æ‰€", "é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼å†…éƒ¨"
            ],
            keywords: [
                "ã‚¿ã‚¤ãƒ ãƒªãƒ¼ãƒ—", "äººå·¥çŸ¥èƒ½", "ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼", "æ™‚ç©º", "ãƒ¡ã‚¿ãƒãƒ¼ã‚¹",
                "ãƒ›ãƒ­ã‚°ãƒ©ãƒ ", "ãƒãƒ¼ãƒãƒ£ãƒ«", "ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯", "æœªæ¥", "ç•°æ¬¡å…ƒ"
            ]
        };
        
        // APIé¸æŠ
        function selectAPI(apiType) {
            selectedAPI = apiType;
            document.querySelectorAll('.api-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            const apiKeySection = document.getElementById('apiKeySection');
            if (apiType === 'local') {
                apiKeySection.style.display = 'none';
            } else {
                apiKeySection.style.display = 'block';
                // ä¿å­˜ã•ã‚ŒãŸAPI Keyã‚’èª­ã¿è¾¼ã¿
                const savedKey = localStorage.getItem(`${apiType}_api_key`);
                if (savedKey) {
                    document.getElementById('apiKey').value = savedKey;
                }
            }
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãƒ†ãƒ¼ãƒç”Ÿæˆï¼ˆAIé¢¨ï¼‰
        function generateRandomTheme() {
            const concept = themeElements.concepts[Math.floor(Math.random() * themeElements.concepts.length)];
            const emotion = themeElements.emotions[Math.floor(Math.random() * themeElements.emotions.length)];
            const setting = themeElements.settings[Math.floor(Math.random() * themeElements.settings.length)];
            const keyword1 = themeElements.keywords[Math.floor(Math.random() * themeElements.keywords.length)];
            const keyword2 = themeElements.keywords[Math.floor(Math.random() * themeElements.keywords.length)];
            
            // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªçµ„ã¿åˆã‚ã›ã‚’ç”Ÿæˆ
            const variations = [
                `${emotion}${concept}`,
                `${setting}ã§ã®${concept}`,
                `${keyword1}ã¨${keyword2}ã®${concept}`,
                `${emotion}${setting}ã®${concept}`,
                `${concept} - ${keyword1}ç·¨`
            ];
            
            const finalConcept = variations[Math.floor(Math.random() * variations.length)];
            const keywords = `${keyword1}, ${keyword2}, ${emotion}, ${setting}`;
            
            return { concept: finalConcept, keywords: keywords };
        }
        
        // ãƒ¡ã‚¤ãƒ³ç”Ÿæˆé–¢æ•°
        async function generateAll() {
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = 'ğŸ¤– AIç”Ÿæˆä¸­...';
            
            try {
                const theme = generateRandomTheme();
                document.getElementById('themeText').textContent = `ğŸ¯ ${theme.concept} (${theme.keywords})`;
                
                const resultsGrid = document.getElementById('resultsGrid');
                resultsGrid.innerHTML = '<div class="loading full-width"><div class="spinner"></div>AIãŒæ¥½æ›²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆä¸­...</div>';
                
                let generation;
                
                // å¸¸ã«ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆã‚’å„ªå…ˆï¼ˆã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
                if (selectedAPI === 'local') {
                    generation = await generateLocalContent(theme);
                } else {
                    // å¤–éƒ¨APIãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆ
                    const apiKey = document.getElementById('apiKey').value;
                    if (!apiKey || apiKey.trim() === '') {
                        // API KeyãŒæœªå…¥åŠ›ã®å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                        console.log('API Keyæœªå…¥åŠ›ã®ãŸã‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§ç”Ÿæˆã—ã¾ã™');
                        generation = await generateLocalContent(theme);
                        showMessage('API Keyæœªå…¥åŠ›ã®ãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«AIã§ç”Ÿæˆã—ã¾ã—ãŸ', 'warning');
                    } else {
                        try {
                            // API Keyä¿å­˜
                            localStorage.setItem(`${selectedAPI}_api_key`, apiKey);
                            generation = await generateAIContent(theme);
                        } catch (apiError) {
                            console.log('APIæ¥ç¶šå¤±æ•—ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯:', apiError);
                            generation = await generateLocalContent(theme);
                            showMessage('APIæ¥ç¶šã«å¤±æ•—ã—ãŸãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«AIã§ç”Ÿæˆã—ã¾ã—ãŸ', 'warning');
                        }
                    }
                }
                
                currentGeneration = {
                    ...generation,
                    theme: theme,
                    timestamp: new Date().toLocaleString('ja-JP')
                };
                
                displayResults(currentGeneration);
                saveToHistory(currentGeneration);
                showSavedIndicator();
                
            } catch (error) {
                console.error('è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼:', error);
                // æœ€å¾Œã®æ‰‹æ®µã¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆ
                try {
                    const theme = generateRandomTheme();
                    const generation = await generateLocalContent(theme);
                    currentGeneration = {
                        ...generation,
                        theme: theme,
                        timestamp: new Date().toLocaleString('ja-JP')
                    };
                    displayResults(currentGeneration);
                    showMessage('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸãŒã€ãƒ­ãƒ¼ã‚«ãƒ«AIã§ç”Ÿæˆã—ã¾ã—ãŸ', 'warning');
                } catch (fallbackError) {
                    document.getElementById('resultsGrid').innerHTML = `
                        <div class="error full-width">
                            âŒ ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}<br>
                            ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚
                        </div>
                    `;
                }
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ² AIæ¥½æ›²ç”Ÿæˆ';
            }
        }
        
        // ãƒ­ãƒ¼ã‚«ãƒ«AIç”Ÿæˆï¼ˆé«˜åº¦ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰
        async function generateLocalContent(theme) {
            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆé…å»¶
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            try {
                return {
                    title: generateAdvancedTitle(theme),
                    lyricsJP: generateAdvancedJapaneseLyrics(theme),
                    lyricsEN: generateAdvancedEnglishLyrics(theme),
                    stylePrompt: generateAdvancedStylePrompt(theme),
                    midjourneyPrompt: generateAdvancedMidjourneyPrompt(theme),
                    aspectRatio: "1:1",
                    model: "v7"
                };
            } catch (error) {
                console.error('ãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®åŸºæœ¬ç”Ÿæˆ
                return {
                    title: `${theme.concept} - AI Generated`,
                    lyricsJP: `[Verse 1]\n${theme.concept}ã®ç‰©èª\nå¿ƒã«éŸ¿ãæƒ³ã„ã‚’è¾¼ã‚ã¦\nãƒ‡ã‚¸ã‚¿ãƒ«ãªä¸–ç•Œã§\nå›ã‚’æ¢ã—ç¶šã‘ã‚‹\n\n[Chorus]\n${theme.concept}ãŒå§‹ã¾ã‚‹\næ–°ã—ã„æœªæ¥ã¸ã¨\næ­©ã„ã¦ã„ã“ã†\næ„›ã‚’èƒ¸ã«æŠ±ã„ã¦`,
                    lyricsEN: `[Verse 1]\nIn this digital world tonight\nSearching for that special light\n${theme.concept} calling out to me\nIn this virtual reality\n\n[Chorus]\n${theme.concept} begins today\nIn this cyber world we'll stay\nLove transcends the digital divide\nWith you right here by my side`,
                    stylePrompt: `Style: Electronic Pop\nMood: Emotional and uplifting\nTempo: 120 BPM\nTheme: ${theme.concept}`,
                    midjourneyPrompt: `${theme.concept}, digital art, cyberpunk aesthetic, emotional atmosphere, high quality`,
                    aspectRatio: "1:1",
                    model: "v7"
                };
            }
        }
        
        // å®Ÿéš›ã®AI APIå‘¼ã³å‡ºã—
        async function generateAIContent(theme) {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                throw new Error('API KeyãŒå¿…è¦ã§ã™');
            }
            
            const prompts = {
                title: `Create a catchy, unique song title for a 3-minute song about "${theme.concept}" with keywords: ${theme.keywords}. Make it viral-worthy and memorable.`,
                lyricsJP: `Create Japanese lyrics for a 3-minute song about "${theme.concept}" with keywords: ${theme.keywords}. Include verse, chorus, bridge structure. Make it catchy and emotionally engaging.`,
                lyricsEN: `Create English lyrics for a 3-minute song about "${theme.concept}" with keywords: ${theme.keywords}. Include verse, chorus, bridge structure. Make it catchy, unique, and perfect for going viral.`,
                stylePrompt: `Create a detailed Suno AI style prompt for a song about "${theme.concept}". Include tempo, instruments, mood, production notes, and specific musical elements.`,
                midjourneyPrompt: `Create a Midjourney prompt for an image that represents a song about "${theme.concept}". Make it visually striking, emotionally resonant, and perfect for album art.`
            };
            
            const results = {};
            
            for (const [key, prompt] of Object.entries(prompts)) {
                try {
                    results[key] = await callAI(prompt, apiKey);
                } catch (error) {
                    console.error(`${key}ç”Ÿæˆã‚¨ãƒ©ãƒ¼:`, error);
                    results[key] = `ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`;
                }
            }
            
            return {
                title: results.title,
                lyricsJP: results.lyricsJP,
                lyricsEN: results.lyricsEN,
                stylePrompt: results.stylePrompt,
                midjourneyPrompt: results.midjourneyPrompt,
                aspectRatio: "1:1",
                model: "v7"
            };
        }
        
        // AI APIå‘¼ã³å‡ºã—
        async function callAI(prompt, apiKey) {
            let url, headers, body;
            
            switch (selectedAPI) {
                case 'openai':
                    url = 'https://api.openai.com/v1/chat/completions';
                    headers = {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    };
                    body = {
                        model: 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 1000
                    };
                    break;
                    
                case 'claude':
                    url = 'https://api.anthropic.com/v1/messages';
                    headers = {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    };
                    body = {
                        model: 'claude-3-sonnet-20240229',
                        max_tokens: 1000,
                        messages: [{ role: 'user', content: prompt }]
                    };
                    break;
                    
                case 'gemini':
                    url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;
                    headers = {
                        'Content-Type': 'application/json'
                    };
                    body = {
                        contents: [{ parts: [{ text: prompt }] }]
                    };
                    break;
            }
            
            const response = await fetch(url, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(body)
            });
            
            if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
            }
            
            const data = await response.json();
            
            // ãƒ¬ã‚¹ãƒãƒ³ã‚¹è§£æ
            switch (selectedAPI) {
                case 'openai':
                    return data.choices[0].message.content;
                case 'claude':
                    return data.content[0].text;
                case 'gemini':
                    return data.candidates[0].content.parts[0].text;
            }
        }
        
        // é«˜åº¦ãªãƒ­ãƒ¼ã‚«ãƒ«ç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
        function generateAdvancedTitle(theme) {
            const patterns = [
                `${theme.concept}`,
                `Digital ${randomWord(['Love', 'Dreams', 'Memories', 'Future'])}`,
                `${randomWord(['Cyber', 'Neo', 'Virtual', 'Quantum'])} ${theme.concept}`,
                `${theme.concept} ${randomWord(['Protocol', 'Syndrome', 'Algorithm', 'Paradox'])}`,
                `${randomWord(['Holographic', 'Binary', 'Electric', 'Neon'])} ${randomWord(['Heart', 'Soul', 'Mind', 'Dreams'])}`
            ];
            
            return patterns[Math.floor(Math.random() * patterns.length)];
        }
        
        function generateAdvancedJapaneseLyrics(theme) {
            const verses = [
                `ãƒ‡ãƒ¼ã‚¿ã®æµ·ã‚’æ¼‚ã£ã¦\nå›ã®å£°ã‚’æ¢ã—ã¦ã‚‹\n${randomWord(['ãƒ‡ã‚¸ã‚¿ãƒ«', 'ãƒãƒ¼ãƒãƒ£ãƒ«', 'ã‚µã‚¤ãƒãƒ¼'])}ãªä¸–ç•Œã§\næœ¬ç‰©ã®æ„›ã‚’è¦‹ã¤ã‘ãŸ`,
                `${randomWord(['ãƒ”ã‚¯ã‚»ãƒ«', 'ã‚³ãƒ¼ãƒ‰', 'ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ '])}ã«éš ã•ã‚ŒãŸæƒ³ã„\n${randomWord(['ã‚¹ã‚¯ãƒªãƒ¼ãƒ³', 'ãƒ¢ãƒ‹ã‚¿ãƒ¼', 'ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤'])}ã®å‘ã“ã†ã®å›\n${randomWord(['ãƒªã‚¢ãƒ«', 'ç¾å®Ÿ', 'ç‰©ç†ä¸–ç•Œ'])}ã‚’è¶…ãˆãŸçµ†\nã“ã®æ°—æŒã¡ã¯ç¢ºã‹ãªã‚‚ã®`,
                `${randomWord(['é‡å­', 'ãƒŠãƒ', 'ãƒ•ã‚©ãƒˆãƒ³'])}ã‚‚ã¤ã‚ŒãŸå¿ƒ\n${randomWord(['æ™‚ç©º', 'æ¬¡å…ƒ', 'ä¸–ç•Œç·š'])}ã‚’è¶Šãˆã¦éŸ¿ã\nå›ã¸ã®æƒ³ã„ãŒæ­¢ã¾ã‚‰ãªã„\næ°¸é ã«ç¶šãã“ã®æ„›ã‚’`
            ];
            
            const choruses = [
                `${theme.concept}ãŒå§‹ã¾ã‚‹\n${randomWord(['ãƒã‚ªãƒ³', 'ãƒ¬ãƒ¼ã‚¶ãƒ¼', 'ãƒ›ãƒ­ã‚°ãƒ©ãƒ '])}ãƒ©ã‚¤ãƒˆãŒè¸Šã‚‹å¤œã«\nå›ã¨åƒ•ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼\n${randomWord(['ãƒªã‚¢ãƒ«', 'ç¾å®Ÿ', 'çœŸå®Ÿ'])}ã‚’è¶…ãˆãŸæ„›ãŒã‚ã‚‹`,
                `${randomWord(['ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ', 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', 'ã‚¯ãƒ©ã‚¦ãƒ‰'])}ã‚’é§†ã‘æŠœã‘ã¦\n${randomWord(['åŒæœŸ', 'ã‚·ãƒ³ã‚¯', 'ãƒªãƒ³ã‚¯'])}ã—ãŸå¿ƒã§\n${theme.concept}ãŒç¶šã\næ°¸é ã®ãƒ«ãƒ¼ãƒ—ã®ä¸­ã§`
            ];
            
            return `[Verse 1]\n${verses[0]}\n\n[Chorus]\n${choruses[0]}\n\n[Verse 2]\n${verses[1]}\n\n[Chorus]\n${choruses[1]}\n\n[Bridge]\n${verses[2]}\n\n[Final Chorus]\n${choruses[0]}`;
        }
        
        function generateAdvancedEnglishLyrics(theme) {
            const verses = [
                `In the ${randomWord(['digital', 'cyber', 'virtual'])} maze tonight\nPixels dancing in the ${randomWord(['neon', 'laser', 'holographic'])} light\n${randomWord(['Time', 'Space', 'Reality'])} bending through the cyber space\nYour ${randomWord(['holographic', 'digital', 'virtual'])} smile, I can't replace`,
                `Streaming data through my neural core\n${randomWord(['Love', 'Emotion', 'Feeling'])} uploading like never before\n${randomWord(['Virtual', 'Digital', 'Cyber'])} reality feels so real\nWhen you're the ${randomWord(['algorithm', 'program', 'code'])} I can feel`
            ];
            
            const choruses = [
                `${theme.concept} in the metaverse\nBreaking through the digital curse\nWe're glitching in and out of time\nYour love's the only perfect rhyme`,
                `${randomWord(['Quantum', 'Digital', 'Electric'])} hearts that beat as one\nIn this cyber world we run\n${theme.concept} never fades\nIn these ${randomWord(['electric', 'digital', 'cyber'])} serenades`
            ];
            
            return `[Verse 1]\n${verses[0]}\n\n[Chorus]\n${choruses[0]}\n\n[Verse 2]\n${verses[1]}\n\n[Chorus]\n${choruses[1]}\n\n[Bridge]\nSometimes the server crashes down\nBut we'll always come around\n${randomWord(['Backup', 'Save', 'Cache'])} saved in cloud nine\nForever you'll be mine\n\n[Final Chorus]\n${choruses[0]}`;
        }
        
        function generateAdvancedStylePrompt(theme) {
            const styles = ['Synthwave', 'Cyberpop', 'Future Bass', 'Electropop', 'Dream Pop', 'Vaporwave'];
            const moods = ['dreamy', 'melancholic', 'euphoric', 'nostalgic', 'futuristic', 'emotional'];
            const tempos = ['120-130 BPM', '110-120 BPM', '130-140 BPM', '100-110 BPM'];
            
            const style = randomWord(styles);
            const mood = randomWord(moods);
            const tempo = randomWord(tempos);
            
            return `Style: ${style} with ${randomWord(['ambient', 'atmospheric', 'ethereal'])} elements
Mood: ${mood} and emotionally engaging
Tempo: ${tempo}
Key: ${randomWord(['C Major', 'A Minor', 'G Major', 'F Major'])}
Instruments: ${randomWord(['Synthesizers', 'Digital piano', 'Electric guitar'])}, ${randomWord(['soft drums', 'electronic beats', '808 drums'])}, ${randomWord(['ethereal pads', 'ambient textures', 'vocal chops'])}
Vocal Style: ${randomWord(['Intimate', 'Dreamy', 'Emotional'])} with subtle ${randomWord(['autotune', 'reverb', 'delay'])}
Production: ${randomWord(['Clean mix', 'Lo-fi aesthetic', 'Polished production'])} with ${randomWord(['ambient reverb', 'spatial effects', 'stereo width'])}
Special Elements: ${randomWord(['Glitch effects', 'Vinyl crackle', 'Digital artifacts'])} during transitions, ${randomWord(['layered harmonies', 'vocal stacks', 'choir pads'])}
Theme: ${theme.concept}
Length: ~3 minutes`;
        }
        
        function generateAdvancedMidjourneyPrompt(theme) {
            const visualStyles = [
                'cyberpunk aesthetic with neon colors',
                'dreamy synthwave landscape',
                'futuristic city with holographic displays',
                'digital art style with glitch effects',
                'anime style cyberpunk romance',
                'vaporwave aesthetic with retro-futuristic elements'
            ];
            
            const colors = [
                'pink and blue neon',
                'purple and cyan gradients',
                'electric blue and magenta',
                'holographic rainbow colors',
                'warm orange and cool blue'
            ];
            
            const elements = [
                'floating geometric shapes',
                'digital rain effect',
                'holographic interfaces',
                'glowing circuit patterns',
                'particle effects'
            ];
            
            const style = randomWord(visualStyles);
            const color = randomWord(colors);
            const element = randomWord(elements);
            
            return `${style}, ${theme.concept} theme, ${color}, ${element}, romantic atmosphere, cinematic lighting, high detail, 4K quality, emotional composition, trending on artstation, digital art masterpiece`;
        }
        
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function randomWord(array) {
            return array[Math.floor(Math.random() * array.length)];
        }
        
        // çµæœè¡¨ç¤º
        function displayResults(generation) {
            const grid = document.getElementById('resultsGrid');
            const initialModel = generation.model === 'v7' ? 'v 7' : generation.model === 'niji6' ? 'niji 6' : 'v 7';
            
            grid.innerHTML = `
                <div class="result-card">
                    <div class="result-header">
                        ğŸµ æ¥½æ›²ã‚¿ã‚¤ãƒˆãƒ«
                        <button class="copy-btn" onclick="copyToClipboard('title')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content" id="titleContent">${generation.title}</div>
                </div>
                
                <div class="result-card">
                    <div class="result-header">
                        ğŸŒ æ—¥æœ¬èªæ­Œè©
                        <button class="copy-btn" onclick="copyToClipboard('lyricsJP')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content" id="lyricsJPContent">${generation.lyricsJP}</div>
                </div>
                
                <div class="result-card">
                    <div class="result-header">
                        ğŸ‡ºğŸ‡¸ è‹±èªæ­Œè©
                        <button class="copy-btn" onclick="copyToClipboard('lyricsEN')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content" id="lyricsENContent">${generation.lyricsEN}</div>
                </div>
                
                <div class="result-card">
                    <div class="result-header">
                        ğŸ¨ Sunoã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                        <button class="copy-btn" onclick="copyToClipboard('stylePrompt')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="result-content" id="stylePromptContent">${generation.stylePrompt}</div>
                </div>
                
                <div class="result-card full-width">
                    <div class="result-header">
                        ğŸ–¼ï¸ Midjourneyç”»åƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                        <button class="copy-btn" onclick="copyToClipboard('midjourneyPrompt')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <div class="midjourney-controls">
                        <div class="control-group">
                            <label>æ¯”ç‡:</label>
                            <select id="aspectRatio" onchange="updateMidjourneyPrompt()">
                                <option value="1:1">1:1 (æ­£æ–¹å½¢)</option>
                                <option value="9:16">9:16 (ç¸¦é•·)</option>
                                <option value="16:9">16:9 (æ¨ªé•·)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>ãƒ¢ãƒ‡ãƒ«:</label>
                            <select id="mjModel" onchange="updateMidjourneyPrompt()">
                                <option value="v7">v7</option>
                                <option value="niji6">niji6</option>
                            </select>
                        </div>
                    </div>
                    <div class="result-content" id="midjourneyPromptContent">${generation.midjourneyPrompt} --ar 1:1 --${initialModel}</div>
                </div>
            `;
        }
        
        // Midjourneyãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ›´æ–°
        function updateMidjourneyPrompt() {
            if (!currentGeneration) return;
            
            const aspectRatio = document.getElementById('aspectRatio').value;
            const model = document.getElementById('mjModel').value;
            const basePrompt = currentGeneration.midjourneyPrompt;
            
            const formattedModel = model === 'v7' ? 'v 7' : model === 'niji6' ? 'niji 6' : model;
            const updatedPrompt = `${basePrompt} --ar ${aspectRatio} --${formattedModel}`;
            document.getElementById('midjourneyPromptContent').textContent = updatedPrompt;
            
            currentGeneration.aspectRatio = aspectRatio;
            currentGeneration.model = model;
        }
        
        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        function copyToClipboard(type) {
            if (!currentGeneration) return;
            
            let text = '';
            switch(type) {
                case 'title':
                    text = currentGeneration.title;
                    break;
                case 'lyricsJP':
                    text = currentGeneration.lyricsJP;
                    break;
                case 'lyricsEN':
                    text = currentGeneration.lyricsEN;
                    break;
                case 'stylePrompt':
                    text = currentGeneration.stylePrompt;
                    break;
                case 'midjourneyPrompt':
                    const aspectRatio = document.getElementById('aspectRatio')?.value || '1:1';
                    const model = document.getElementById('mjModel')?.value || 'v7';
                    const formattedModel = model === 'v7' ? 'v 7' : model === 'niji6' ? 'niji 6' : model;
                    text = `${currentGeneration.midjourneyPrompt} --ar ${aspectRatio} --${formattedModel}`;
                    break;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                showCopySuccess();
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopySuccess();
            });
        }
        
        function showCopySuccess() {
            const indicator = document.getElementById('savedIndicator');
            indicator.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }
        
        function showSavedIndicator() {
            const indicator = document.getElementById('savedIndicator');
            indicator.textContent = 'ğŸ’¾ è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã—ãŸ';
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }
        
        function showMessage(message, type = 'info') {
            const indicator = document.getElementById('savedIndicator');
            const icon = type === 'warning' ? 'âš ï¸' : type === 'error' ? 'âŒ' : 'â„¹ï¸';
            indicator.textContent = `${icon} ${message}`;
            indicator.style.background = type === 'warning' ? '#ffc107' : type === 'error' ? '#dc3545' : '#28a745';
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 4000);
        }
        
        function saveToHistory(generation) {
            let history = JSON.parse(localStorage.getItem('aiSunoHistory') || '[]');
            history.unshift(generation);
            history = history.slice(0, 10);
            localStorage.setItem('aiSunoHistory', JSON.stringify(history));
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('load', () => {
            selectAPI('local');
        });
    </script>
</body>
</html>